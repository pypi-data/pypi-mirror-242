(()=>{"use strict";function t(t,n,e,r){if(isNaN(n)||isNaN(e))return t;var i,o,a,u,l,s,h,f,c,y=t._root,x={data:r},_=t._x0,v=t._y0,p=t._x1,g=t._y1;if(!y)return t._root=x,t;for(;y.length;)if((s=n>=(o=(_+p)/2))?_=o:p=o,(h=e>=(a=(v+g)/2))?v=a:g=a,i=y,!(y=y[f=h<<1|s]))return i[f]=x,t;if(u=+t._x.call(null,y.data),l=+t._y.call(null,y.data),n===u&&e===l)return x.next=y,i?i[f]=x:t._root=x,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(s=n>=(o=(_+p)/2))?_=o:p=o,(h=e>=(a=(v+g)/2))?v=a:g=a}while((f=h<<1|s)==(c=(l>=a)<<1|u>=o));return i[c]=y,i[f]=x,t}function n(t,n,e,r,i){this.node=t,this.x0=n,this.y0=e,this.x1=r,this.y1=i}function e(t){return t[0]}function r(t){return t[1]}function i(t,n,i){var a=new o(null==n?e:n,null==i?r:i,NaN,NaN,NaN,NaN);return null==t?a:a.addAll(t)}function o(t,n,e,r,i,o){this._x=t,this._y=n,this._x0=e,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function a(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var u=i.prototype=o.prototype;function l(t){return function(){return t}}function s(t){return 1e-6*(t()-.5)}u.copy=function(){var t,n,e=new o(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return e;if(!r.length)return e._root=a(r),e;for(t=[{source:r,target:e._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(n=r.source[i])&&(n.length?t.push({source:n,target:r.target[i]=new Array(4)}):r.target[i]=a(n));return e},u.add=function(n){const e=+this._x.call(null,n),r=+this._y.call(null,n);return t(this.cover(e,r),e,r,n)},u.addAll=function(n){var e,r,i,o,a=n.length,u=new Array(a),l=new Array(a),s=1/0,h=1/0,f=-1/0,c=-1/0;for(r=0;r<a;++r)isNaN(i=+this._x.call(null,e=n[r]))||isNaN(o=+this._y.call(null,e))||(u[r]=i,l[r]=o,i<s&&(s=i),i>f&&(f=i),o<h&&(h=o),o>c&&(c=o));if(s>f||h>c)return this;for(this.cover(s,h).cover(f,c),r=0;r<a;++r)t(this,u[r],l[r],n[r]);return this},u.cover=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(e))i=(e=Math.floor(t))+1,o=(r=Math.floor(n))+1;else{for(var a,u,l=i-e||1,s=this._root;e>t||t>=i||r>n||n>=o;)switch(u=(n<r)<<1|t<e,(a=new Array(4))[u]=s,s=a,l*=2,u){case 0:i=e+l,o=r+l;break;case 1:e=i-l,o=r+l;break;case 2:i=e+l,r=o-l;break;case 3:e=i-l,r=o-l}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._y0=r,this._x1=i,this._y1=o,this},u.data=function(){var t=[];return this.visit((function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)})),t},u.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},u.find=function(t,e,r){var i,o,a,u,l,s,h,f=this._x0,c=this._y0,y=this._x1,x=this._y1,_=[],v=this._root;for(v&&_.push(new n(v,f,c,y,x)),null==r?r=1/0:(f=t-r,c=e-r,y=t+r,x=e+r,r*=r);s=_.pop();)if(!(!(v=s.node)||(o=s.x0)>y||(a=s.y0)>x||(u=s.x1)<f||(l=s.y1)<c))if(v.length){var p=(o+u)/2,g=(a+l)/2;_.push(new n(v[3],p,g,u,l),new n(v[2],o,g,p,l),new n(v[1],p,a,u,g),new n(v[0],o,a,p,g)),(h=(e>=g)<<1|t>=p)&&(s=_[_.length-1],_[_.length-1]=_[_.length-1-h],_[_.length-1-h]=s)}else{var d=t-+this._x.call(null,v.data),w=e-+this._y.call(null,v.data),m=d*d+w*w;if(m<r){var N=Math.sqrt(r=m);f=t-N,c=e-N,y=t+N,x=e+N,i=v.data}}return i},u.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var n,e,r,i,o,a,u,l,s,h,f,c,y=this._root,x=this._x0,_=this._y0,v=this._x1,p=this._y1;if(!y)return this;if(y.length)for(;;){if((s=o>=(u=(x+v)/2))?x=u:v=u,(h=a>=(l=(_+p)/2))?_=l:p=l,n=y,!(y=y[f=h<<1|s]))return this;if(!y.length)break;(n[f+1&3]||n[f+2&3]||n[f+3&3])&&(e=n,c=f)}for(;y.data!==t;)if(r=y,!(y=y.next))return this;return(i=y.next)&&delete y.next,r?(i?r.next=i:delete r.next,this):n?(i?n[f]=i:delete n[f],(y=n[0]||n[1]||n[2]||n[3])&&y===(n[3]||n[2]||n[1]||n[0])&&!y.length&&(e?e[c]=y:this._root=y),this):(this._root=i,this)},u.removeAll=function(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this},u.root=function(){return this._root},u.size=function(){var t=0;return this.visit((function(n){if(!n.length)do{++t}while(n=n.next)})),t},u.visit=function(t){var e,r,i,o,a,u,l=[],s=this._root;for(s&&l.push(new n(s,this._x0,this._y0,this._x1,this._y1));e=l.pop();)if(!t(s=e.node,i=e.x0,o=e.y0,a=e.x1,u=e.y1)&&s.length){var h=(i+a)/2,f=(o+u)/2;(r=s[3])&&l.push(new n(r,h,f,a,u)),(r=s[2])&&l.push(new n(r,i,f,h,u)),(r=s[1])&&l.push(new n(r,h,o,a,f)),(r=s[0])&&l.push(new n(r,i,o,h,f))}return this},u.visitAfter=function(t){var e,r=[],i=[];for(this._root&&r.push(new n(this._root,this._x0,this._y0,this._x1,this._y1));e=r.pop();){var o=e.node;if(o.length){var a,u=e.x0,l=e.y0,s=e.x1,h=e.y1,f=(u+s)/2,c=(l+h)/2;(a=o[0])&&r.push(new n(a,u,l,f,c)),(a=o[1])&&r.push(new n(a,f,l,s,c)),(a=o[2])&&r.push(new n(a,u,c,f,h)),(a=o[3])&&r.push(new n(a,f,c,s,h))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},u.x=function(t){return arguments.length?(this._x=t,this):this._x},u.y=function(t){return arguments.length?(this._y=t,this):this._y};var h={value:()=>{}};function f(){for(var t,n=0,e=arguments.length,r={};n<e;++n){if(!(t=arguments[n]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new c(r)}function c(t){this._=t}function y(t,n){return t.trim().split(/^|\s+/).map((function(t){var e="",r=t.indexOf(".");if(r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))}function x(t,n){for(var e,r=0,i=t.length;r<i;++r)if((e=t[r]).name===n)return e.value}function _(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=h,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=e&&t.push({name:n,value:e}),t}c.prototype=f.prototype={constructor:c,on:function(t,n){var e,r=this._,i=y(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++o<a;)if(e=(t=i[o]).type)r[e]=_(r[e],t.name,n);else if(null==n)for(e in r)r[e]=_(r[e],t.name,null);return this}for(;++o<a;)if((e=(t=i[o]).type)&&(e=x(r[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new c(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r,i=new Array(e),o=0;o<e;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(r=this._[t]).length;o<e;++o)r[o].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};const v=f;var p,g,d=0,w=0,m=0,N=0,M=0,k=0,A="object"==typeof performance&&performance.now?performance:Date,b="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function q(){return M||(b(E),M=A.now()+k)}function E(){M=0}function z(){this._call=this._time=this._next=null}function D(t,n,e){var r=new z;return r.restart(t,n,e),r}function P(){M=(N=A.now())+k,d=w=0;try{!function(){q(),++d;for(var t,n=p;n;)(t=M-n._time)>=0&&n._call.call(null,t),n=n._next;--d}()}finally{d=0,function(){for(var t,n,e=p,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:p=n);g=t,j(r)}(),M=0}}function T(){var t=A.now(),n=t-N;n>1e3&&(k-=n,N=t)}function j(t){d||(w&&(w=clearTimeout(w)),t-M>24?(t<1/0&&(w=setTimeout(P,t-A.now()-k)),m&&(m=clearInterval(m))):(m||(N=A.now(),m=setInterval(T,1e3)),d=1,b(P)))}z.prototype=D.prototype={constructor:z,restart:function(t,n,e){if("function"!=typeof t)throw new TypeError("callback is not a function");e=(null==e?q():+e)+(null==n?0:+n),this._next||g===this||(g?g._next=this:p=this,g=this),this._call=t,this._time=e,j()},stop:function(){this._call&&(this._call=null,this._time=1/0,j())}};const O=4294967296;function I(t){return t.x}function F(t){return t.y}var L=Math.PI*(3-Math.sqrt(5));function S(t){return t.index}function B(t,n){var e=t.get(n);if(!e)throw new Error("node not found: "+n);return e}function C(t,n){var e,r=1;function i(){var i,o,a=e.length,u=0,l=0;for(i=0;i<a;++i)u+=(o=e[i]).x,l+=o.y;for(u=(u/a-t)*r,l=(l/a-n)*r,i=0;i<a;++i)(o=e[i]).x-=u,o.y-=l}return null==t&&(t=0),null==n&&(n=0),i.initialize=function(t){e=t},i.x=function(n){return arguments.length?(t=+n,i):t},i.y=function(t){return arguments.length?(n=+t,i):n},i.strength=function(t){return arguments.length?(r=+t,i):r},i}let G=null,H=null,J=!1,K=0,Q=0,R=1,U=0,V=0;const W=function(){var t,n,e,r,o,a=l(-30),u=1,h=1/0,f=.81;function c(e){var o,a=t.length,u=i(t,I,F).visitAfter(x);for(r=e,o=0;o<a;++o)n=t[o],u.visit(_)}function y(){if(t){var n,e,r=t.length;for(o=new Array(r),n=0;n<r;++n)e=t[n],o[e.index]=+a(e,n,t)}}function x(t){var n,e,r,i,a,u=0,l=0;if(t.length){for(r=i=a=0;a<4;++a)(n=t[a])&&(e=Math.abs(n.value))&&(u+=n.value,l+=e,r+=e*n.x,i+=e*n.y);t.x=r/l,t.y=i/l}else{(n=t).x=n.data.x,n.y=n.data.y;do{u+=o[n.data.index]}while(n=n.next)}t.value=u}function _(t,i,a,l){if(!t.value)return!0;var c=t.x-n.x,y=t.y-n.y,x=l-i,_=c*c+y*y;if(x*x/f<_)return _<h&&(0===c&&(_+=(c=s(e))*c),0===y&&(_+=(y=s(e))*y),_<u&&(_=Math.sqrt(u*_)),n.vx+=c*t.value*r/_,n.vy+=y*t.value*r/_),!0;if(!(t.length||_>=h)){(t.data!==n||t.next)&&(0===c&&(_+=(c=s(e))*c),0===y&&(_+=(y=s(e))*y),_<u&&(_=Math.sqrt(u*_)));do{t.data!==n&&(x=o[t.data.index]*r/_,n.vx+=c*x,n.vy+=y*x)}while(t=t.next)}}return c.initialize=function(n,r){t=n,e=r,y()},c.strength=function(t){return arguments.length?(a="function"==typeof t?t:l(+t),y(),c):a},c.distanceMin=function(t){return arguments.length?(u=t*t,c):Math.sqrt(u)},c.distanceMax=function(t){return arguments.length?(h=t*t,c):Math.sqrt(h)},c.theta=function(t){return arguments.length?(f=t*t,c):Math.sqrt(f)},c}(),X=function(t){var n,e,r,i,o,a,u=S,h=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},f=l(30),c=1;function y(r){for(var i=0,u=t.length;i<c;++i)for(var l,h,f,y,x,_,v,p=0;p<u;++p)h=(l=t[p]).source,y=(f=l.target).x+f.vx-h.x-h.vx||s(a),x=f.y+f.vy-h.y-h.vy||s(a),y*=_=((_=Math.sqrt(y*y+x*x))-e[p])/_*r*n[p],x*=_,f.vx-=y*(v=o[p]),f.vy-=x*v,h.vx+=y*(v=1-v),h.vy+=x*v}function x(){if(r){var a,l,s=r.length,h=t.length,f=new Map(r.map(((t,n)=>[u(t,n,r),t])));for(a=0,i=new Array(s);a<h;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=B(f,l.source)),"object"!=typeof l.target&&(l.target=B(f,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(a=0,o=new Array(h);a<h;++a)l=t[a],o[a]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);n=new Array(h),_(),e=new Array(h),v()}}function _(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}function v(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+f(t[n],n,t)}return null==t&&(t=[]),y.initialize=function(t,n){r=t,a=n,x()},y.links=function(n){return arguments.length?(t=n,x(),y):t},y.id=function(t){return arguments.length?(u=t,y):u},y.iterations=function(t){return arguments.length?(c=+t,y):c},y.strength=function(t){return arguments.length?(h="function"==typeof t?t:l(+t),_(),y):h},y.distance=function(t){return arguments.length?(f="function"==typeof t?t:l(+t),v(),y):f},y}(),Y=C(),Z=function(t){var n,e=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,u=new Map,l=D(f),s=v("tick","end"),h=function(){let t=1;return()=>(t=(1664525*t+1013904223)%O)/O}();function f(){c(),s.call("tick",n),e<r&&(l.stop(),s.call("end",n))}function c(r){var l,s,h=t.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(e+=(o-e)*i,u.forEach((function(t){t(e)})),l=0;l<h;++l)null==(s=t[l]).fx?s.x+=s.vx*=a:(s.x=s.fx,s.vx=0),null==s.fy?s.y+=s.vy*=a:(s.y=s.fy,s.vy=0);return n}function y(){for(var n,e=0,r=t.length;e<r;++e){if((n=t[e]).index=e,null!=n.fx&&(n.x=n.fx),null!=n.fy&&(n.y=n.fy),isNaN(n.x)||isNaN(n.y)){var i=10*Math.sqrt(.5+e),o=e*L;n.x=i*Math.cos(o),n.y=i*Math.sin(o)}(isNaN(n.vx)||isNaN(n.vy))&&(n.vx=n.vy=0)}}function x(n){return n.initialize&&n.initialize(t,h),n}return null==t&&(t=[]),y(),n={tick:c,restart:function(){return l.restart(f),n},stop:function(){return l.stop(),n},nodes:function(e){return arguments.length?(t=e,y(),u.forEach(x),n):t},alpha:function(t){return arguments.length?(e=+t,n):e},alphaMin:function(t){return arguments.length?(r=+t,n):r},alphaDecay:function(t){return arguments.length?(i=+t,n):+i},alphaTarget:function(t){return arguments.length?(o=+t,n):o},velocityDecay:function(t){return arguments.length?(a=1-t,n):1-a},randomSource:function(t){return arguments.length?(h=t,u.forEach(x),n):h},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,x(e)),n):u.get(t)},find:function(n,e,r){var i,o,a,u,l,s=0,h=t.length;for(null==r?r=1/0:r*=r,s=0;s<h;++s)(a=(i=n-(u=t[s]).x)*i+(o=e-u.y)*o)<r&&(l=u,r=a);return l},on:function(t,e){return arguments.length>1?(s.on(t,e),n):s.on(t)}}}().force("center",C()).force("charge",W).force("link",X).force("center",Y).stop().on("tick",(()=>{self.postMessage({progress:V<=1?0:V/U,positions:G.map((t=>({x:t.x,y:t.y})))}),--V}));self.onmessage=t=>{var n,e,r,i;(n=t.data).updateNodes&&n.nodes.length>0&&(e=n.nodes,G&&G.length===e.length?e.forEach(((t,n)=>{G[n].r=t})):(G=e.map(((t,n)=>({id:n,r:t}))),Z.nodes(G),J&&(X.links(H),J=!1),R=Math.pow(G.length,Q),W.strength(-K/R))),n.updateLinks&&n.links.length&&(r=n.links,H&&H.length===r.length||(H=r,G?X.links(H):J=!0)),n.updateProps&&(i=n.props,K=i.simulation_repulsion_strength,Q=i.simulation_repulsion_normalization,R=G?Math.pow(G.length,Q):1,W.strength(-K/R),X.strength((t=>i.simulation_link_strength*t.distance)),Y.strength(i.simulation_center_strength),W.distanceMax(i.simulation_repulsion_limit)),n.updateDrag&&function({idx:t,x:n,y:e}){G[t].fx=n,G[t].fy=e}(n.node),G&&H&&function(t){Z.alpha(t);const n=Z.alphaMin(),e=Z.alphaDecay(),r=Math.round(Math.log(n/t)/Math.log(1-e));U=Math.max(V,r),V=U,Z.restart()}(n.alpha)}})();