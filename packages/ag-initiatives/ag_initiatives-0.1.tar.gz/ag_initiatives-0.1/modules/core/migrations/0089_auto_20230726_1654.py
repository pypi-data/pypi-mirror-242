# Generated by Django 2.2.5 on 2023-07-26 09:54

from django.db import migrations, models
import django.db.models.deletion
import collections


class LkoLevelOld:
    REGIONAL = "REGIONAL"
    MUNICIPAL = "MUNICIPAL"
    DEPARTMENTAL = "DEPARTMENTAL"

    RESOLVER = collections.OrderedDict([
        (REGIONAL, "Региональный"),
        (MUNICIPAL, "Муниципальный"),
        (DEPARTMENTAL, "Ведомственный")
    ])

    CHOICES = RESOLVER.items()


class LkoTypeOld:
    ROIV = "ROIV"
    ROIV_DIVISION = "ROIV_DIVISION"
    OMSU_SETTLEMENT = "OMSU_SETTLEMENT"
    OMSU_OTHER = "OMSU_OTHER"
    OTHER_GOVERNMENT_AGENCY = "OTHER_GOVERNMENT_AGENCY"
    COMMERCIAL_ORGANIZATION = "COMMERCIAL_ORGANIZATION"

    RESOLVER = collections.OrderedDict([
        (ROIV, "РОИВ"),
        (ROIV_DIVISION, "Подразделение РОИВ"),
        (OMSU_SETTLEMENT, "ОМСУ (городские и сельские поселения)"),
        (OMSU_OTHER, "ОМСУ (иные - кроме городских и сельских)"),
        (OTHER_GOVERNMENT_AGENCY, "Прочие государственные/муниципальные учреждения и предприятия"),
        (COMMERCIAL_ORGANIZATION, "Коммерческие организации")
    ])

    CHOICES = RESOLVER.items()


def copy_enum_values(apps, schema_editor):
    lko_level = apps.get_model('core', 'LkoLevel')
    lko_type = apps.get_model('core', 'LkoType')
    department_sub_info = apps.get_model('core', 'DepartmentSubInfo')

    for k, v in LkoLevelOld.CHOICES:
        lko_level.objects.create(name=v)

    for k, v in LkoTypeOld.CHOICES:
        lko_type.objects.create(name=v)

    for d in department_sub_info.objects.all():
        for level in lko_level.objects.all():
            if d.lko_level and LkoLevelOld.RESOLVER.get(d.lko_level) == level.name:
                d.lko_level_new = level
                d.save()
        for ltype in lko_type.objects.all():
            if d.lko_type and LkoTypeOld.RESOLVER.get(d.lko_type) == ltype.name:
                d.lko_type_new = ltype
                d.save()


class Migration(migrations.Migration):
    dependencies = [
        ('core', '0088_auto_20230726_1250'),
    ]

    operations = [
        migrations.RunPython(copy_enum_values),
    ]
