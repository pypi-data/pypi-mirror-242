# Generated by Django 2.2.5 on 2023-07-26 11:08

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion

def update_permissions_data(apps, schema_editor):
    admin_lko_permissions = apps.get_model('core', 'AdminLkoPermissions')
    operator_lko_permissions = apps.get_model('core', 'OperatorLkoPermissions')

    for i in admin_lko_permissions.objects.all():
        i.save()

    for i in operator_lko_permissions.objects.all():
        i.save()

    user = apps.get_model('core', 'User')
    for i in user.objects.all():
        try:
            i.sub_phone = i.sub_permissions.sub_phone
        except:
            pass


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0088_auto_20230726_1738'),
    ]

    operations = [

        migrations.AlterModelOptions(
            name='blockfile',
            options={'verbose_name': 'Файл', 'verbose_name_plural': 'Файлы'},
        ),
        migrations.AddField(
            model_name='adminlkopermissions',
            name='user',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='Пользователь'),
        ),
        migrations.AddField(
            model_name='operatorlkopermissions',
            name='user',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE,
                                       to=settings.AUTH_USER_MODEL, verbose_name='Пользователь'),
        ),
        migrations.AddField(
            model_name='user',
            name='sub_phone',
            field=models.CharField(blank=True, max_length=12, null=True, verbose_name='Добавочный номер'),
        ),
        migrations.RunPython(update_permissions_data),
    ]
