import{S as $,i as ee,s as te,D as F,Z as K,_ as Q,m as w,h as _,n as E,$ as pe,b as V,a0 as v,K as Se,a1 as z,M as Z,Q as ae,q as R,r as A,u as j,k as C,y as oe,l as H,z as re,F as T,A as ce,a7 as de,W as it,g as N,d as I,B as ue,a as Y,c as q,v as J,f as x,a2 as Ge,a3 as Ce,N as st,G as fe,L as Ke,X as Qe,Y as at,p as O,ah as ot,ao as rt,a4 as ct,O as ke,ai as dt,e as He,a8 as Pe}from"./index.c820bada.js";import{ay as Ve,d as ut,h as Ze,N as ft,_ as ye,X as Je,a8 as xe,aj as ht,ai as G,a2 as we,g as mt,b3 as gt,al as _t,b7 as pt,av as bt,bx as vt,bp as kt}from"./Commands.9e466438.js";import{f as Be,g as yt}from"./notificationsStore.315ab01e.js";import{c as Ee,L as Le,a as Te}from"./colors.f6cbcb11.js";function Ie(n){let e,t;return{c(){e=K("title"),t=R(n[1])},l(l){e=Q(l,"title",{});var a=w(e);t=A(a,n[1]),a.forEach(_)},m(l,a){V(l,e,a),v(e,t)},p(l,a){a&2&&j(t,l[1])},d(l){l&&_(e)}}}function wt(n){let e,t,l=n[1]&&Ie(n),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],d={};for(let i=0;i<a.length;i+=1)d=F(d,a[i]);return{c(){e=K("svg"),l&&l.c(),t=K("path"),this.h()},l(i){e=Q(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=w(e);l&&l.l(o),t=Q(o,"path",{d:!0}),w(t).forEach(_),o.forEach(_),this.h()},h(){E(t,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),pe(e,d)},m(i,o){V(i,e,o),l&&l.m(e,null),v(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=Ie(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),pe(e,d=Se(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Et(n,e,t){let l,a;const d=["size","title"];let i=Z(e,d),{size:o=16}=e,{title:s=void 0}=e;return n.$$set=r=>{t(5,e=F(F({},e),ae(r))),t(3,i=Z(e,d)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,s=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||s),t(2,a={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,s,a,i,l]}class St extends ${constructor(e){super(),ee(this,e,Et,wt,te,{size:0,title:1})}}function Me(n){let e,t;return{c(){e=K("title"),t=R(n[1])},l(l){e=Q(l,"title",{});var a=w(e);t=A(a,n[1]),a.forEach(_)},m(l,a){V(l,e,a),v(e,t)},p(l,a){a&2&&j(t,l[1])},d(l){l&&_(e)}}}function Nt(n){let e,t,l=n[1]&&Me(n),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],d={};for(let i=0;i<a.length;i+=1)d=F(d,a[i]);return{c(){e=K("svg"),l&&l.c(),t=K("path"),this.h()},l(i){e=Q(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=w(e);l&&l.l(o),t=Q(o,"path",{d:!0}),w(t).forEach(_),o.forEach(_),this.h()},h(){E(t,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),pe(e,d)},m(i,o){V(i,e,o),l&&l.m(e,null),v(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=Me(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),pe(e,d=Se(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Ct(n,e,t){let l,a;const d=["size","title"];let i=Z(e,d),{size:o=16}=e,{title:s=void 0}=e;return n.$$set=r=>{t(5,e=F(F({},e),ae(r))),t(3,i=Z(e,d)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,s=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||s),t(2,a={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,s,a,i,l]}class Ht extends ${constructor(e){super(),ee(this,e,Ct,Nt,te,{size:0,title:1})}}function Pt(n,e){const t=l=>n&&!n.contains(l.target)&&!l.defaultPrevented&&e();return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Vt(n){let e=(n[1]?"":n[0])+"",t;return{c(){t=R(e)},l(l){t=A(l,e)},m(l,a){V(l,t,a)},p(l,a){a&3&&e!==(e=(l[1]?"":l[0])+"")&&j(t,e)},d(l){l&&_(t)}}}function Bt(n){let e,t,l,a,d;const i=[n[2],{type:"purple"},{icon:Ve}];let o={$$slots:{default:[Vt]},$$scope:{ctx:n}};for(let s=0;s<i.length;s+=1)o=F(o,i[s]);return t=new ut({props:o}),{c(){e=C("div"),oe(t.$$.fragment),this.h()},l(s){e=H(s,"DIV",{class:!0});var r=w(e);re(t.$$.fragment,r),r.forEach(_),this.h()},h(){E(e,"class","embedding-badge truncate"),T(e,"embedding-badge-nolabel",n[1])},m(s,r){V(s,e,r),ce(t,e,null),l=!0,a||(d=de(Ze.call(null,e,{text:"Embedding index"})),a=!0)},p(s,[r]){const c=r&4?Se(i,[r&4&&it(s[2]),i[1],r&0&&{icon:Ve}]):{};r&11&&(c.$$scope={dirty:r,ctx:s}),t.$set(c),(!l||r&2)&&T(e,"embedding-badge-nolabel",s[1])},i(s){l||(N(t.$$.fragment,s),l=!0)},o(s){I(t.$$.fragment,s),l=!1},d(s){s&&_(e),ue(t),a=!1,d()}}}function Lt(n,e,t){const l=["embedding","hideEmbeddingName"];let a=Z(e,l),{embedding:d}=e,{hideEmbeddingName:i=!1}=e;return n.$$set=o=>{e=F(F({},e),ae(o)),t(2,a=Z(e,l)),"embedding"in o&&t(0,d=o.embedding),"hideEmbeddingName"in o&&t(1,i=o.hideEmbeddingName)},[d,i,a]}class Tt extends ${constructor(e){super(),ee(this,e,Lt,Bt,te,{embedding:0,hideEmbeddingName:1})}}function ze(n,e,t){const l=n.slice();return l[12]=e[t],l}function Re(n){let e,t,l=n[0].conceptNamespace+"",a,d,i=n[0].conceptName+"",o,s,r,c,u,h,m,b,p,k,g;return u=new Ht({}),b=new St({}),{c(){e=C("div"),t=C("div"),a=R(l),d=R(" / "),o=R(i),s=Y(),r=C("div"),c=C("button"),oe(u.$$.fragment),h=Y(),m=C("button"),oe(b.$$.fragment),this.h()},l(y){e=H(y,"DIV",{class:!0});var B=w(e);t=H(B,"DIV",{class:!0});var M=w(t);a=A(M,l),d=A(M," / "),o=A(M,i),M.forEach(_),s=q(B),r=H(B,"DIV",{class:!0});var P=w(r);c=H(P,"BUTTON",{class:!0});var L=w(c);re(u.$$.fragment,L),L.forEach(_),h=q(P),m=H(P,"BUTTON",{class:!0});var W=w(m);re(b.$$.fragment,W),W.forEach(_),P.forEach(_),B.forEach(_),this.h()},h(){E(t,"class","flex-grow"),E(c,"class","p-1"),E(m,"class","p-1"),E(r,"class","shrink-0"),E(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(y,B){V(y,e,B),v(e,t),v(t,a),v(t,d),v(t,o),v(e,s),v(e,r),v(r,c),ce(u,c,null),v(r,h),v(r,m),ce(b,m,null),p=!0,k||(g=[fe(c,"click",n[8]),fe(m,"click",n[9])],k=!0)},p(y,B){(!p||B&1)&&l!==(l=y[0].conceptNamespace+"")&&j(a,l),(!p||B&1)&&i!==(i=y[0].conceptName+"")&&j(o,i)},i(y){p||(N(u.$$.fragment,y),N(b.$$.fragment,y),p=!0)},o(y){I(u.$$.fragment,y),I(b.$$.fragment,y),p=!1},d(y){y&&_(e),ue(u),ue(b),k=!1,Ke(g)}}}function Ae(n){let e,t=[],l=new Map,a,d=n[2];const i=o=>o[12];for(let o=0;o<d.length;o+=1){let s=ze(n,d,o),r=i(s);l.set(r,t[o]=De(r,s))}return{c(){e=C("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=H(o,"DIV",{class:!0});var s=w(e);for(let r=0;r<t.length;r+=1)t[r].l(s);s.forEach(_),this.h()},h(){E(e,"class","more-button flex flex-col")},m(o,s){V(o,e,s);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null);a=!0},p(o,s){s&29&&(d=o[2],J(),t=Qe(t,s,i,1,o,d,l,e,at,De,null,ze),x())},i(o){if(!a){for(let s=0;s<d.length;s+=1)N(t[s]);a=!0}},o(o){for(let s=0;s<t.length;s+=1)I(t[s]);a=!1},d(o){o&&_(e);for(let s=0;s<t.length;s+=1)t[s].d()}}}function De(n,e){let t,l,a,d,i,o,s,r,c;i=new Tt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function u(){return e[10](e[12])}return{key:n,first:null,c(){t=C("button"),l=C("div"),a=R("Find similar"),d=Y(),oe(i.$$.fragment),o=Y(),this.h()},l(h){t=H(h,"BUTTON",{class:!0});var m=w(t);l=H(m,"DIV",{});var b=w(l);a=A(b,"Find similar"),b.forEach(_),d=q(m),re(i.$$.fragment,m),o=q(m),m.forEach(_),this.h()},h(){E(t,"class","flex w-full items-center justify-between"),this.first=t},m(h,m){V(h,t,m),v(t,l),v(l,a),v(t,d),ce(i,t,null),v(t,o),s=!0,r||(c=fe(t,"click",u),r=!0)},p(h,m){e=h;const b={};m&4&&(b.embedding=e[12]),i.$set(b)},i(h){s||(N(i.$$.fragment,h),s=!0)},o(h){I(i.$$.fragment,h),s=!1},d(h){h&&_(t),ue(i),r=!1,c()}}}function It(n){let e,t,l,a,d,i,o,s=n[0].conceptName!=null&&n[0].conceptNamespace!=null&&Re(n),r=n[3]!=null&&Ae(n);return{c(){e=C("div"),s&&s.c(),t=Y(),r&&r.c(),this.h()},l(c){e=H(c,"DIV",{style:!0,class:!0});var u=w(e);s&&s.l(u),t=q(u),r&&r.l(u),u.forEach(_),this.h()},h(){E(e,"style",l=n[1]!=null?`left: ${n[1].x}px; top: ${n[1].y}px`:""),E(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(c,u){V(c,e,u),s&&s.m(e,null),v(e,t),r&&r.m(e,null),d=!0,i||(o=de(Pt.call(null,e,n[11])),i=!0)},p(c,[u]){c[0].conceptName!=null&&c[0].conceptNamespace!=null?s?(s.p(c,u),u&1&&N(s,1)):(s=Re(c),s.c(),N(s,1),s.m(e,t)):s&&(J(),I(s,1,1,()=>{s=null}),x()),c[3]!=null?r?(r.p(c,u),u&8&&N(r,1)):(r=Ae(c),r.c(),N(r,1),r.m(e,null)):r&&(J(),I(r,1,1,()=>{r=null}),x()),(!d||u&2&&l!==(l=c[1]!=null?`left: ${c[1].x}px; top: ${c[1].y}px`:""))&&E(e,"style",l)},i(c){d||(N(s),N(r),Ge(()=>{d&&(a||(a=Ce(e,Be,{duration:60},!0)),a.run(1))}),d=!0)},o(c){I(s),I(r),a||(a=Ce(e,Be,{duration:60},!1)),a.run(0),d=!1},d(c){c&&_(e),s&&s.d(),r&&r.d(),c&&a&&a.end(),i=!1,o()}}}function Mt(n,e,t){let{details:l}=e,{clickPosition:a}=e,{embeddings:d}=e,{addConceptLabel:i}=e,{findSimilar:o}=e,{addNotification:s}=e;const r=st();function c(p){if(!l.conceptName||!l.conceptNamespace)throw Error("Label could not be added, no active concept.");i(l.conceptNamespace,l.conceptName,l.text,p),s({kind:"success",title:`[${p===!0?"Positive":"Negative"}] Concept label added`,subtitle:ft(l.conceptNamespace,l.conceptName),message:l.text}),r("click")}const u=()=>c(!0),h=()=>c(!1),m=p=>{o&&o(p,l.text),r("click")},b=()=>r("close");return n.$$set=p=>{"details"in p&&t(0,l=p.details),"clickPosition"in p&&t(1,a=p.clickPosition),"embeddings"in p&&t(2,d=p.embeddings),"addConceptLabel"in p&&t(6,i=p.addConceptLabel),"findSimilar"in p&&t(3,o=p.findSimilar),"addNotification"in p&&t(7,s=p.addNotification)},[l,a,d,o,r,c,i,s,u,h,m,b]}class zt extends ${constructor(e){super(),ee(this,e,Mt,It,te,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function Rt(n,e){let t,l=e;n.addEventListener("click",i=>a(i));function a(i){l.disabled||(t=new zt({props:{details:l.details(),clickPosition:{x:i.clientX,y:i.clientY},embeddings:l.embeddings,addConceptLabel:l.addConceptLabel,addNotification:l.addNotification,findSimilar:l.findSimilar},target:document.body}),t.$on("close",d),t.$on("click",d))}function d(){t==null||t.$destroy(),t=void 0}return{update(i){l=i,t==null||t.$set({details:l.details()})},destroy(){d()}}}function Oe(n,e,t){const l=n.slice();return l[7]=e[t],l}function Fe(n,e){let t,l,a=e[7].info.name+"",d,i,o,s,r=Ue(e[7])+"",c,u;return{key:n,first:null,c(){t=C("div"),l=C("div"),d=R(a),i=Y(),o=C("div"),s=C("span"),c=R(r),u=Y(),this.h()},l(h){t=H(h,"DIV",{class:!0});var m=w(t);l=H(m,"DIV",{class:!0});var b=w(l);d=A(b,a),b.forEach(_),i=q(m),o=H(m,"DIV",{class:!0});var p=w(o);s=H(p,"SPAN",{class:!0});var k=w(s);c=A(k,r),k.forEach(_),p.forEach(_),u=q(m),m.forEach(_),this.h()},h(){E(l,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),E(s,"class","px-1"),T(s,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!ye(e[7].info.dtype)),O(s,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ee(e[7].value):""),E(o,"class","table-cell rounded text-right"),E(t,"class","table-row"),this.first=t},m(h,m){V(h,t,m),v(t,l),v(l,d),v(t,i),v(t,o),v(o,s),v(s,c),v(t,u)},p(h,m){e=h,m&1&&a!==(a=e[7].info.name+"")&&j(d,a),m&1&&r!==(r=Ue(e[7])+"")&&j(c,r),m&1&&T(s,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!ye(e[7].info.dtype)),m&1&&O(s,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ee(e[7].value):"")},d(h){h&&_(t)}}}function At(n){let e,t,l=[],a=new Map,d,i=`${n[4]}px`,o=`${Math.min(n[1],n[3]-n[2]-20)}px`,s=n[0];const r=c=>c[7];for(let c=0;c<s.length;c+=1){let u=Oe(n,s,c),h=r(u);a.set(h,l[c]=Fe(h,u))}return{c(){e=C("div"),t=C("div");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){e=H(c,"DIV",{role:!0,class:!0});var u=w(e);t=H(u,"DIV",{class:!0});var h=w(t);for(let m=0;m<l.length;m+=1)l[m].l(h);h.forEach(_),u.forEach(_),this.h()},h(){E(t,"class","table border-spacing-y-2"),E(e,"role","tooltip"),E(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Ge(()=>n[6].call(e)),T(e,"hidden",n[0].length===0),O(e,"top",i),O(e,"left",o)},m(c,u){V(c,e,u),v(e,t);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(t,null);d=ot(e,n[6].bind(e))},p(c,[u]){u&1&&(s=c[0],l=Qe(l,u,r,1,c,s,a,t,rt,Fe,null,Oe)),u&1&&T(e,"hidden",c[0].length===0),u&6&&o!==(o=`${Math.min(c[1],c[3]-c[2]-20)}px`)&&O(e,"left",o)},i:z,o:z,d(c){c&&_(e);for(let u=0;u<l.length;u+=1)l[u].d();d()}}}function Ue(n){return typeof n.value=="number"?n.value.toFixed(3):n.info.dtype.type==="string_span"?"true":n.value}function Dt(n,e,t){let{namedValues:l}=e,{x:a}=e,{y:d}=e;const i=window.innerWidth;let o=0;const s=d-1;function r(){o=this.clientWidth,t(2,o)}return n.$$set=c=>{"namedValues"in c&&t(0,l=c.namedValues),"x"in c&&t(1,a=c.x),"y"in c&&t(5,d=c.y)},[l,a,o,i,s,d,r]}class Ot extends ${constructor(e){super(),ee(this,e,Dt,At,te,{namedValues:0,x:1,y:5})}}function Ft(n,e){let t,l=e;const a=()=>i();l.isHovered&&d();function d(){const o=l.namedValues.filter(h=>Array.from(l.spansHovered).some(m=>{const b=Je(m);return xe(h.specificPath.slice(0,b.length),b)}));l.itemScrollContainer!=null&&l.itemScrollContainer.addEventListener("scroll",a);const s=n.getBoundingClientRect(),r=window.getComputedStyle(n),c=parseInt(r.getPropertyValue("line-height")),u=s.height>c?s.x+n.offsetLeft||n.clientLeft:s.x;t=new Ot({props:{namedValues:o,x:u,y:s.top},target:document.body})}function i(){var o;t==null||t.$destroy(),(o=l.itemScrollContainer)==null||o.removeEventListener("scroll",a)}return{update(o){i(),l=o,l.isHovered&&d()},destroy(){i()}}}const je=600,_e=50;function Ut(n,e,t){const l=[],a=new Set;for(const d of n){let i=!1;const o=[];for(const g of d.paths)a.has(g)||(o.push(g),a.add(g));const s=[],r=[];let c=-1/0;for(const[g,y]of Object.entries(d.originalSpans)){const B=e[g],M=Je(g);if(!(B==null||B.length===0))for(const P of y)for(const L of B){const W=L.path.slice(M.length),U=ht(P,W);if(U==null)continue;const D=G.value(U),he=G.span(U);if(D==null&&he==null)continue;if(L.dtype.type==="float32"){const le=G.value(U);le!=null&&(c=Math.max(c,le))}const me=we(G.path(P)),be=!o.includes(me),X={value:D,info:L,specificPath:G.path(U)};be||s.push(X),r.push(X),L.type==="concept_score"||L.type==="semantic_similarity"?D>.5&&(i=!0):i=!0}}const u=r.some(g=>g.info.type==="label"),h=r.some(g=>g.info.type==="leaf_span"),m=r.some(g=>g.info.type==="keyword"),b=r.some(g=>g.info.type==="metadata"&&!ye(g.info.dtype)),p=d.paths.some(g=>t.has(g)),k=p&&o.length>0&&Array.from(t).some(g=>o.includes(g));l.push({backgroundColor:Ee(c),isBlackBolded:m||b||h,isHighlightBolded:u,isHighlighted:i,snippetScore:c,namedValues:s,paths:d.paths,text:d.text,originalSpans:d.originalSpans,isHovered:p,isFirstHover:k})}return l}function jt(n,e){var d;let t=!1,l=!1,a=[];for(let i=0;i<n.length;i++){const o=n[i],s=i-1>=0?n[i-1]:null,r=i+1<n.length?n[i+1]:null,c=(d=a.at(-1))==null?void 0:d.isEllipsis;if(!o.isHighlighted){if(c||s!=null&&s.isHighlighted||r!=null&&r.isHighlighted)continue;t=!0,a.push({isEllipsis:!0});continue}l=!0,s!=null&&!s.isHighlighted&&(!c&&s.text.length>_e&&(a.push({isEllipsis:!0}),t=!0),a.push({renderSpan:s,snippetText:s.text.slice(-_e)})),a.push({renderSpan:o,snippetText:o.text}),r!=null&&!r.isHighlighted&&(a.push({renderSpan:r,snippetText:r.text.slice(0,_e)}),!c&&r.text.length>_e&&(a.push({isEllipsis:!0}),t=!0))}return l||(a=[],t=!1,a.push({renderSpan:n[0],snippetText:n[0].text.slice(0,je)}),((n[1]||null)!=null||n[0].text.length>je)&&(a.push({isEllipsis:!0}),t=!0)),e&&(a=n.map(i=>({renderSpan:i,snippetText:i.text}))),{snippetSpans:a,textIsOverBudget:t}}function Ye(n,e,t){const l=n.slice();return l[33]=e[t],l}function Yt(n){const e=n.slice(),t=e[33].renderSpan;return e[36]=t,e}function qt(n){let e,t,l,a;return{c(){e=C("span"),t=R(`...
      `),this.h()},l(d){e=H(d,"SPAN",{class:!0});var i=w(e);t=A(i,`...
      `),i.forEach(_),this.h()},h(){E(e,"class","highlight-span text-sm leading-5 svelte-nwcx2h")},m(d,i){V(d,e,i),v(e,t),l||(a=de(Ze.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),l=!0)},p:z,i:z,o:z,d(d){d&&_(e),l=!1,a()}}}function Wt(n){let e,t,l,a,d,i,o,s,r;const c=[Gt,Xt],u=[];function h(k,g){return k[2]?0:1}t=h(n),l=u[t]=c[t](n);function m(){return n[29](n[36])}function b(){return n[30](n[36])}function p(){return n[31](n[36])}return{c(){e=C("span"),l.c(),a=Y(),this.h()},l(k){e=H(k,"SPAN",{class:!0});var g=w(e);l.l(g),a=q(g),g.forEach(_),this.h()},h(){E(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-nwcx2h"),T(e,"highlighted",n[36].isHighlighted),T(e,"hover:cursor-pointer",n[1].length>0),T(e,"font-bold",n[36].isBlackBolded),T(e,"font-medium",n[36].isHighlightBolded&&!n[36].isBlackBolded),O(e,"color",n[36].isHighlightBolded&&!n[36].isBlackBolded?Le:""),O(e,"background-color",n[36].isHovered?Te(We):n[36].backgroundColor)},m(k,g){V(k,e,g),u[t].m(e,null),v(e,a),o=!0,s||(r=[de(d=Ft.call(null,e,{namedValues:n[36].namedValues,isHovered:n[36].isFirstHover,spansHovered:n[5],itemScrollContainer:n[7]})),de(i=Rt.call(null,e,{details:m,findSimilar:n[8].page==="datasets"?n[16]:null,embeddings:n[3],addConceptLabel:n[14],addNotification:n[17]!=null?n[17].addNotification:Xe,disabled:n[36].paths.length===0||n[3].length===0})),fe(e,"mouseenter",b),fe(e,"mouseleave",p)],s=!0)},p(k,g){n=k;let y=t;t=h(n),t===y?u[t].p(n,g):(J(),I(u[y],1,1,()=>{u[y]=null}),x(),l=u[t],l?l.p(n,g):(l=u[t]=c[t](n),l.c()),N(l,1),l.m(e,a)),d&&Pe(d.update)&&g[0]&224&&d.update.call(null,{namedValues:n[36].namedValues,isHovered:n[36].isFirstHover,spansHovered:n[5],itemScrollContainer:n[7]}),i&&Pe(i.update)&&g[0]&328&&i.update.call(null,{details:m,findSimilar:n[8].page==="datasets"?n[16]:null,embeddings:n[3],addConceptLabel:n[14],addNotification:n[17]!=null?n[17].addNotification:Xe,disabled:n[36].paths.length===0||n[3].length===0}),(!o||g[0]&64)&&T(e,"highlighted",n[36].isHighlighted),(!o||g[0]&2)&&T(e,"hover:cursor-pointer",n[1].length>0),(!o||g[0]&64)&&T(e,"font-bold",n[36].isBlackBolded),(!o||g[0]&64)&&T(e,"font-medium",n[36].isHighlightBolded&&!n[36].isBlackBolded),g[0]&64&&O(e,"color",n[36].isHighlightBolded&&!n[36].isBlackBolded?Le:""),g[0]&64&&O(e,"background-color",n[36].isHovered?Te(We):n[36].backgroundColor)},i(k){o||(N(l),o=!0)},o(k){I(l),o=!1},d(k){k&&_(e),u[t].d(),s=!1,Ke(r)}}}function Xt(n){let e=n[33].snippetText+"",t;return{c(){t=R(e)},l(l){t=A(l,e)},m(l,a){V(l,t,a)},p(l,a){a[0]&64&&e!==(e=l[33].snippetText+"")&&j(t,e)},i:z,o:z,d(l){l&&_(t)}}}function Gt(n){let e,t;return e=new kt({props:{source:n[33].snippetText}}),{c(){oe(e.$$.fragment)},l(l){re(e.$$.fragment,l)},m(l,a){ce(e,l,a),t=!0},p(l,a){const d={};a[0]&64&&(d.source=l[33].snippetText),e.$set(d)},i(l){t||(N(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function qe(n){let e,t,l,a;const d=[Wt,qt],i=[];function o(r,c){return r[33].isEllipsis?1:0}function s(r,c){return c===0?Yt(r):r}return e=o(n),t=i[e]=d[e](s(n,e)),{c(){t.c(),l=He()},l(r){t.l(r),l=He()},m(r,c){i[e].m(r,c),V(r,l,c),a=!0},p(r,c){let u=e;e=o(r),e===u?i[e].p(s(r,e),c):(J(),I(i[u],1,1,()=>{i[u]=null}),x(),t=i[e],t?t.p(s(r,e),c):(t=i[e]=d[e](s(r,e)),t.c()),N(t,1),t.m(l.parentNode,l))},i(r){a||(N(t),a=!0)},o(r){I(t),a=!1},d(r){i[e].d(r),r&&_(l)}}}function Kt(n){let e,t,l=n[6],a=[];for(let i=0;i<l.length;i+=1)a[i]=qe(Ye(n,l,i));const d=i=>I(a[i],1,1,()=>{a[i]=null});return{c(){e=C("div");for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=H(i,"DIV",{class:!0});var o=w(e);for(let s=0;s<a.length;s+=1)a[s].l(o);o.forEach(_),this.h()},h(){E(e,"class","overflow-x-hidden text-ellipsis whitespace-break-spaces svelte-nwcx2h"),T(e,"text-preview-overlay",n[0]&&!n[4])},m(i,o){V(i,e,o);for(let s=0;s<a.length;s+=1)a[s]&&a[s].m(e,null);t=!0},p(i,o){if(o[0]&220654){l=i[6];let s;for(s=0;s<l.length;s+=1){const r=Ye(i,l,s);a[s]?(a[s].p(r,o),N(a[s],1)):(a[s]=qe(r),a[s].c(),N(a[s],1),a[s].m(e,null))}for(J(),s=l.length;s<a.length;s+=1)d(s);x()}(!t||o[0]&17)&&T(e,"text-preview-overlay",i[0]&&!i[4])},i(i){if(!t){for(let o=0;o<l.length;o+=1)N(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)I(a[o]);t=!1},d(i){i&&_(e),ct(a,i)}}}const We=.9,Xe=()=>null;function Qt(n,e,t){let l,a,d,i,o,{text:s}=e,{row:r}=e,{field:c=void 0}=e,{spanPaths:u}=e,{path:h=void 0}=e,{valuePaths:m}=e,{markdown:b=!1}=e,{embeddings:p}=e,{datasetViewStore:k=void 0}=e,{isExpanded:g=!1}=e,{textIsOverBudget:y=!1}=e;const B=mt();ke(n,B,f=>t(8,o=f));let M,P={},L=new Set;const W=f=>{f.paths.forEach(S=>L.add(S)),t(5,L)},U=f=>{f.paths.forEach(S=>L.delete(S)),t(5,L)};let D={};const he=f=>{const ne={conceptName:null,conceptNamespace:null,text:a.filter(ie=>ie.paths.some(ve=>((f==null?void 0:f.paths)||[]).some(se=>xe(se,ve)))).map(ie=>ie.text).join("")};for(const ie of Object.keys(f.originalSpans)){const ve=(P[ie]||[]).filter(se=>se.type==="concept_score");for(const se of ve){const Ne=se.signal;ne.conceptName=Ne.concept_name,ne.conceptNamespace=Ne.namespace;break}}return ne},me=gt();ke(n,me,f=>t(32,d=f));const be=(f,S,ge,ne)=>{if(!S||!f)throw Error("Label could not be added, no active concept.");d.mutate([f,S,{insert:[{text:ge,label:ne}]}])};let X,le=dt(_t);ke(n,le,f=>t(7,i=f));const $e=(f,S)=>{k==null||c==null||k.addSearch({path:c.path,type:"semantic",query_type:"document",query:S,embedding:f})},et=yt(),tt=f=>he(f),lt=f=>W(f),nt=f=>U(f);return n.$$set=f=>{"text"in f&&t(18,s=f.text),"row"in f&&t(19,r=f.row),"field"in f&&t(20,c=f.field),"spanPaths"in f&&t(1,u=f.spanPaths),"path"in f&&t(21,h=f.path),"valuePaths"in f&&t(22,m=f.valuePaths),"markdown"in f&&t(2,b=f.markdown),"embeddings"in f&&t(3,p=f.embeddings),"datasetViewStore"in f&&t(23,k=f.datasetViewStore),"isExpanded"in f&&t(4,g=f.isExpanded),"textIsOverBudget"in f&&t(0,y=f.textIsOverBudget)},n.$$.update=()=>{if(n.$$.dirty[0]&2621442&&(t(24,M={}),u.forEach(f=>{const S=pt(r,f);t(24,M[we(f)]=S.filter(ge=>bt(G.path(ge),h)||h==null),M)})),n.$$.dirty[0]&37748736){t(25,P={});for(const f of m){const S=we(f.spanPath);P[S]==null&&t(25,P[S]=[],P),P[S].push(f)}}if(n.$$.dirty[0]&17039360&&t(28,l=vt(s,M)),n.$$.dirty[0]&301989920&&t(27,a=Ut(l,P,L)),n.$$.dirty[0]&335544320){t(26,D={});for(const f of l)for(const S of f.paths)t(26,D[S]=D[S]||[],D),D[S].push(f)}n.$$.dirty[0]&134217744&&t(6,{snippetSpans:X,textIsOverBudget:y}=jt(a,g),X,(t(0,y),t(27,a),t(4,g),t(28,l),t(25,P),t(5,L),t(18,s),t(24,M),t(22,m),t(1,u),t(19,r),t(21,h)))},[y,u,b,p,g,L,X,i,o,B,W,U,he,me,be,le,$e,et,s,r,c,h,m,k,M,P,D,a,l,tt,lt,nt]}class el extends ${constructor(e){super(),ee(this,e,Qt,Kt,te,{text:18,row:19,field:20,spanPaths:1,path:21,valuePaths:22,markdown:2,embeddings:3,datasetViewStore:23,isExpanded:4,textIsOverBudget:0},null,[-1,-1])}}export{Tt as E,el as S,Ht as T,St as a,Pt as c};
