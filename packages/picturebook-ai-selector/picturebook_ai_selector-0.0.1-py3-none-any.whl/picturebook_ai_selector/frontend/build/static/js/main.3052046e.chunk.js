(this.webpackJsonpst_text_select=this.webpackJsonpst_text_select||[]).push([[0],{20:function(t,e,s){"use strict";s.r(e);var n=s(5),a=s(2),r=(s(3),s(0));class c extends a.b{constructor(){super(...arguments),this.state={text:"",actual_text:[],annotations:[],selectedReference:0},this.getCharactersCountUntilNode=(t,e)=>{const s=document.createTreeWalker(e||document.body,NodeFilter.SHOW_TEXT,null);let n=0;for(;s.nextNode();){var a;if(s.currentNode===t)break;n+=(null===(a=s.currentNode.textContent)||void 0===a?void 0:a.length)||0}return n},this.handleMouseUp=async()=>{var t;const e=null===(t=document.getSelection())||void 0===t?void 0:t.getRangeAt(0);if(e&&""!==e.toString().trim()){var s;let t=e.toString(),n=e.startOffset,r=e.endOffset,c=0,o=0;const i=document.getElementById("actual-text");n+=this.getCharactersCountUntilNode(e.startContainer,i),r+=this.getCharactersCountUntilNode(e.endContainer,i);const l=(null===(s=document.querySelector("#actual-text"))||void 0===s?void 0:s.textContent)||"",d=/^[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;for(;" "!==l.charAt(n+c-1)&&!l.charAt(n+c-1).match(d)&&void 0!==(null===l||void 0===l?void 0:l.charAt(n+c-1))&&""!==l.charAt(n+c-1);)c-=1;const h=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]$/g;for(;" "!==l.charAt(r+o)&&!l.charAt(r+o).match(h)&&void 0!==l.charAt(r+o)&&""!==l.charAt(r+o);)o+=1;t=l.slice(n+c,r+o)||"";const{annotations:u,selectedReference:x}=this.state;u[x]||(u[x]=[]);const f=n+c,p=r+o;if(this.isAnnotated(f,p)){const t=this.removeAnnotation(f,p);await this.setState({annotations:t})}else u[x].push({start:f,end:p,label:t}),await this.setState({annotations:u});a.a.setComponentValue(u)}this.setState({actual_text:this.renderText()})}}async componentDidMount(){const{text:t,annotations:e}=this.props.args;await this.setState({text:t,annotations:e}),await this.setState({actual_text:this.renderText()}),a.a.setComponentValue(e)}isAnnotated(t,e){const{annotations:s,selectedReference:n}=this.state;if(!s[n])return!1;for(let a=0;a<s[n].length;a++)if(t>=s[n][a].start&&e<=s[n][a].end||t<=s[n][a].start&&e>=s[n][a].end||t<=s[n][a].start&&e>s[n][a].start&&e<=s[n][a].end||t>=s[n][a].start&&t<s[n][a].end&&e>=s[n][a].end)return!0;return!1}removeAnnotation(t,e){const{annotations:s,selectedReference:n}=this.state;for(let a=0;a<s[n].length;a++)if(t>=s[n][a].start&&e<=s[n][a].end||t<=s[n][a].start&&e>=s[n][a].end||t<=s[n][a].start&&e>s[n][a].start&&e<=s[n][a].end||t>=s[n][a].start&&t<s[n][a].end&&e>=s[n][a].end){s[n].splice(a,1);break}return 0===s[n].length&&s.splice(n,1),s}async addReference(){const{annotations:t}=this.state;if(t[this.state.selectedReference]&&0===t[this.state.selectedReference].length)return;const e=t.length+1;t[e]||(t[e]=[]),await this.setState({selectedReference:e,annotations:t}),this.setState({actual_text:this.renderText()})}async selectReference(t){this.state.selectedReference!==t&&this.state.annotations[t]&&(await this.setState({selectedReference:t}),this.setState({actual_text:this.renderText()}))}async removeReference(t){const{annotations:e}=this.state;e.splice(t,1),await this.setState({annotations:e,selectedReference:0}),this.setState({actual_text:this.renderText()}),a.a.setComponentValue(e)}renderText(){const{text:t,annotations:e,selectedReference:s}=this.state,n=[];if(!e[s])return[Object(r.jsx)("span",{children:t})];let a=0;return e[s].length>0&&e[s].sort(((t,e)=>t.start-e.start)),e[s].forEach(((e,s)=>{n.push(Object(r.jsx)("span",{children:t.substring(a,e.start)})),n.push(Object(r.jsx)("span",{className:"annotated bg-blue-500 text-gray-100",children:t.substring(e.start,e.end)})),a=e.end})),n.push(Object(r.jsx)("span",{children:t.substring(a,t.length)})),n}render(){return Object(r.jsx)("div",{children:Object(r.jsx)("div",{id:"actual-text",className:"mt-5 h-full",onMouseUp:this.handleMouseUp,children:this.state.actual_text})})}oldrender(){return Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{className:"flex flex-row flex-wrap",children:[Object(r.jsx)("div",{className:"flex flex-wrap px-4 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100 bg-blue-500 text-gray-100",onClick:()=>this.addReference(),children:Object(r.jsx)("span",{children:"Add"})}),this.state.annotations.map(((t,e)=>{var s;return Object(r.jsxs)("span",{className:"flex flex-wrap pl-4 pr-2 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100"+(this.state.selectedReference===e?" bg-blue-500 text-gray-100":" bg-blue-900 text-gray-200"),onClick:()=>{this.selectReference(e)},children:[null===(s=t[0])||void 0===s?void 0:s.label,Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-3 hover:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",onClick:()=>{this.removeReference(e)},children:Object(r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"})})]},e)}))]}),Object(r.jsx)("div",{id:"actual-text",className:"mt-5 h-full",onMouseUp:this.handleMouseUp,children:this.state.actual_text})]})}}var o=Object(a.c)(c);const i=document.getElementById("root");Object(n.createRoot)(i).render(Object(r.jsx)(o,{}))}},[[20,1,2]]]);
//# sourceMappingURL=main.3052046e.chunk.js.map