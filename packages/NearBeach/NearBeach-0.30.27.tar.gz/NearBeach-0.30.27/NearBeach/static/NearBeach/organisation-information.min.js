"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[4093],{5106:(e,o,t)=>{t.r(o),t.d(o,{default:()=>W});var i=t(6252),a=t(9963);const r={class:"card"},n={class:"card-body"},s=(0,i._)("h1",null,"Organisation Information",-1),l=(0,i._)("br",null,null,-1),d=["href"],u=(0,i._)("hr",null,null,-1),c={class:"row"},g=(0,i._)("div",{class:"col-md-4"},[(0,i._)("strong",null,"Please Note"),(0,i._)("p",{class:"text-instructions"}," Please only use generic information for both the website and email. Do not use any personal details - you can create contacts in the section below. ")],-1),p={class:"col-md-3"},m=["src"],h=(0,i._)("br",null,null,-1),_={class:"col-md-5"},f={class:"form-group"},w={for:"id_organisation_name"},M=(0,i._)("br",null,null,-1),v={class:"form-group"},b={for:"id_organisation_website"},E=(0,i._)("br",null,null,-1),y={class:"form-group"},$={for:"id_organisation_email"},k=(0,i._)("br",null,null,-1),P={key:0},U={key:1,class:"row submit-row"},I={class:"col-md-12"};var T=t(9729),S=t(4344),L=t(989),N=t(5705),O=t(760),R=t(7939),x=t(3058),q=t(8416),B=t(106);const C={name:"OrganisationInformation",setup:()=>({v$:(0,N.ZP)()}),components:{NButton:T.ZP,NUpload:S.Z,ValidationRendering:R.Z},props:{organisationResults:{type:Array,default:()=>[]}},mixins:[x.Z,B.Z,q.Z],computed:{...(0,L.Se)({rootUrl:"getRootUrl",staticUrl:"getStaticUrl",userLevel:"getUserLevel"})},data(){return{organisationNameModel:this.organisationResults[0].fields.organisation_name,organisationEmailModel:this.organisationResults[0].fields.organisation_email,organisationWebsiteModel:this.organisationResults[0].fields.organisation_website,profilePicture:""}},validations:{organisationNameModel:{required:O.C1,maxLength:(0,O.BS)(255)},organisationWebsiteModel:{required:O.C1,url:O.HQ},organisationEmailModel:{required:O.C1,email:O.Do}},methods:{showErrorToast(){this.$store.dispatch("newToast",{header:"Error uploading profile picture",message:"Sorry, we had an issue uploading the profile image.",extra_classes:"bg-danger",delay:0})},setProfilePicture(){let e=this.organisationResults[0].fields.organisation_profile_picture;this.profilePicture=null!=e&&""!==e?`${this.rootUrl}private/${e}`:`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`},updateOrganisation(){if(this.v$.$touch(),this.v$.$invalid)return void this.showValidationErrorModal();const e=new FormData;e.set("organisation_name",this.organisationNameModel),e.set("organisation_email",this.organisationEmailModel),e.set("organisation_website",this.organisationWebsiteModel),this.showLoadingModal("Organisation"),this.axios.post(`${this.rootUrl}organisation_information/${this.organisationResults[0].pk}/save/`,e).then((e=>{this.closeLoadingModal()})).catch((e=>{this.showErrorModal(e,"organisation",this.organisationResults[0].pk)}))},updateProfilePicture(){this.$store.dispatch("newToast",{header:"Profile Picture updated",message:"Good news - profile picture updated",extra_classes:"bg-success",unique_type:"update_profile",delay:0}),this.axios.post(`${this.rootUrl}organisation_information/${this.organisationResults[0].pk}/get_profile_picture/`).then((e=>{this.profilePicture=e.data,this.$store.dispatch("newToast",{header:"Profile Picture updated",message:"Good news - profile picture updated",extra_classes:"bg-success",unique_type:"update_profile"})})).catch((e=>{this.profilePicture=`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`,this.$store.dispatch("newToast",{header:"Error uploading profile picture",message:`Sorry, we had an issue uploading the profile image. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))}},mounted(){this.setProfilePicture()}},W=(0,t(3744).Z)(C,[["render",function(e,o,t,T,S,L){const N=(0,i.up)("n-button"),O=(0,i.up)("n-upload"),R=(0,i.up)("validation-rendering");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",n,[(0,i.kq)(" TITLE "),s,l,(0,i._)("a",{href:`${e.rootUrl}search/organisation/`},"Back to organisation search",8,d),u,(0,i.kq)(" FIELDS SECTION "),(0,i._)("div",c,[g,(0,i._)("div",p,[(0,i._)("img",{src:S.profilePicture,alt:"Profile Picture",class:"organisation-profile-image"},null,8,m),h,(0,i.kq)('<button class="btn btn-primary">Update Profile...</button>'),e.userLevel>1?((0,i.wg)(),(0,i.j4)(O,{key:0,action:`${e.rootUrl}organisation_information/${t.organisationResults[0].pk}/update_profile/`,headers:{"X-CSRFTOKEN":e.getToken("csrftoken")},data:{},onFinish:L.updateProfilePicture,onError:L.showErrorToast},{default:(0,i.w5)((()=>[(0,i.Wm)(N,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Update Profile Picture")])),_:1})])),_:1},8,["action","headers","onFinish","onError"])):(0,i.kq)("v-if",!0)]),(0,i._)("div",_,[(0,i.kq)(" ORGANISATION NAME "),(0,i._)("div",f,[(0,i._)("label",w,[(0,i.Uk)(" Organisation Name "),(0,i.Wm)(R,{"error-list":T.v$.organisationNameModel.$errors},null,8,["error-list"])]),(0,i.wy)((0,i._)("input",{id:"id_organisation_name","onUpdate:modelValue":o[0]||(o[0]=e=>S.organisationNameModel=e),type:"text",class:"form-control"},null,512),[[a.vModelText,S.organisationNameModel]])]),M,(0,i.kq)(" ORGANISATION WEBSITE "),(0,i._)("div",v,[(0,i._)("label",b,[(0,i.Uk)(" Organisation Website "),(0,i.Wm)(R,{"error-list":T.v$.organisationWebsiteModel.$errors},null,8,["error-list"])]),(0,i.wy)((0,i._)("input",{id:"id_organisation_website","onUpdate:modelValue":o[1]||(o[1]=e=>S.organisationWebsiteModel=e),type:"text",class:"form-control"},null,512),[[a.vModelText,S.organisationWebsiteModel]])]),E,(0,i.kq)(" ORGANISATION EMAIL "),(0,i._)("div",y,[(0,i._)("label",$,[(0,i.Uk)(" Organisation Email "),(0,i.Wm)(R,{"error-list":T.v$.organisationWebsiteModel.$errors},null,8,["error-list"])]),(0,i.wy)((0,i._)("input",{id:"id_organisation_email","onUpdate:modelValue":o[2]||(o[2]=e=>S.organisationEmailModel=e),type:"text",class:"form-control"},null,512),[[a.vModelText,S.organisationEmailModel]])])])]),k,(0,i.kq)(" NEED TO APPLY PERMISSIONS "),(0,i.kq)(" Submit Button "),e.userLevel>1?((0,i.wg)(),(0,i.iD)("hr",P)):(0,i.kq)("v-if",!0),e.userLevel>1?((0,i.wg)(),(0,i.iD)("div",U,[(0,i._)("div",I,[(0,i._)("a",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:o[3]||(o[3]=(...e)=>L.updateOrganisation&&L.updateOrganisation(...e))},"Update Organisation")])])):(0,i.kq)("v-if",!0)])])}]])},7939:(e,o,t)=>{t.d(o,{Z:()=>n});var i=t(6252),a=t(3577);const r={name:"ValidationRendering",props:{errorList:{type:Array,default:()=>[]}}},n=(0,t(3744).Z)(r,[["render",function(e,o,t,r,n,s){return(0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.errorList,(e=>((0,i.wg)(),(0,i.iD)("span",{class:"error",key:e.$uid},(0,a.toDisplayString)(e.$message),1)))),128)}]])},3058:(e,o,t)=>{t.d(o,{Z:()=>a});var i=t(3138);const a={methods:{showErrorModal(e,o,t){const a=document.getElementById("loadingModal");if(null===a)return;new i.u_(a).hide();const r=document.getElementById("errorModalContent");if(void 0===r)return;if(r.innerHTML=`<strong>HTML ISSUE:</strong> We could not save the new ${o}-${t}<hr>${e}`,null===document.getElementById("errorModal"))return;const n=new i.u_(n);n.show()},showValidationErrorModal(){document.getElementById("errorModalContent").innerHTML="<strong>FORM ISSUE:</strong> Sorry, but can you please fill out the form completely.",new i.u_(document.getElementById("errorModal")).show()}}}},106:(e,o,t)=>{t.d(o,{Z:()=>i});const i={methods:{getToken(e){const o=new RegExp(`${e}=([^;]+)`).exec(document.cookie);return null!==o?encodeURIComponent(o[1]):null}}}},8416:(e,o,t)=>{t.d(o,{Z:()=>a});var i=t(3138);const a={methods:{closeLoadingModal(){const e=new i.u_(document.getElementById("loadingModal"));document.getElementById("loadingModalContent").innerHTML="UPDATED SUCCESSFULLY",setTimeout((()=>{e.hide()}),1e3)},showLoadingModal(e){new i.u_(document.getElementById("loadingModal")).show(),document.getElementById("loadingModalContent").innerHTML=`Updating your ${e} details`}}}}}]);