[LOCAL_SETUP]
FILE = templates/common/common.localsetup
PLATFORM = LOCAL

[SYNCHRONIZE]
FILE = templates/common/common.synchronize.sh
PLATFORM = transfer_node
DEPENDENCIES = LOCAL_SETUP

[REMOTE_SETUP]
FILE = sources/runtime/autosubmit/compilation.sh
DEPENDENCIES = SYNCHRONIZE
WALLCLOCK = 2:00
PROCESSORS = 4
CUSTOM_DIRECTIVES = ["#SBATCH -p interactive"]

[INI]
FILE = templates/ecearth3/ecearth3.ini
DEPENDENCIES = REMOTE_SETUP
RUNNING = member
WALLCLOCK = 00:30
QUEUE = debug

[SIM]
FILE = sources/runtime/autosubmit/ece-ifs+nemo.sh
DEPENDENCIES = INI SIM-1 CLEAN-2
RUNNING = chunk
WALLCLOCK = 02:00
PROCESSORS = 768
TASKS = 48
THREADS = 1
#CHECK = On_Submission
CHECK = false
QUEUE = debug

[CMOROCE]
FILE = templates/ecearth3/ecearth3.cmoroce
DEPENDENCIES = SIM
WALLCLOCK = 1:00
RUNNING = chunk
NOTIFY_ON = RUNNING FAILED COMPLETED
TASKS = 8
CUSTOM_DIRECTIVES = ["#SBATCH --cpus-per-task=4", "#SBATCH --constraint=highmem" ]

[CMORATM]
FILE = templates/ecearth3/ecearth3.cmoratm
DEPENDENCIES = SIM
WALLCLOCK = 1:00
RUNNING = chunk
NOTIFY_ON = RUNNING FAILED COMPLETED
TASKS = 8
CUSTOM_DIRECTIVES = ["#SBATCH --cpus-per-task=4"]
# Uncomment this line for yearly runs. SPLITS must be less or equal to CHUNKSIZE. If CHUNKSIZE=1, leave it commented
# SPLITS = 12


[POST]
FILE = templates/ecearth3/ecearth3.post
DEPENDENCIES = SIM SIM+1 CMOROCE CMORATM
RUNNING = chunk
WALLCLOCK = 01:00
CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]


#CMORATM needs the data from the previous month of the SIM
[CLEAN]
FILE = templates/ecearth3/ecearth3.clean
DEPENDENCIES = POST POST+1
RUNNING = chunk
WALLCLOCK = 00:30
QUEUE = debug

#[SAVEIC]
#FILE = templates/common/common.saveic
#DEPENDENCIES = SIM
#RUNNING = chunk
#WALLCLOCK = 00:30

[CLEAN_MEMBER]
FILE = templates/common/common.clean_member
DEPENDENCIES = CLEAN
#DEPENDENCIES = CLEAN SAVEIC
RUNNING = member
WALLCLOCK = 02:30

[TRANSFER]
FILE = templates/common/common.localtrans
PLATFORM = transfer_node
DEPENDENCIES = CLEAN
RUNNING = chunk

[PERFORMANCE_METRICS]
FILE = templates/ecearth3/ecearth3.performance_metrics.sh
DEPENDENCIES = TRANSFER
RUNNING = once
WALLCLOCK = 00:01
PROCESSORS = 1
PLATFORM = LOCAL

[TRANSFER_MEMBER]
FILE = templates/common/common.transfer_member
PLATFORM = transfer_node
DEPENDENCIES = CLEAN_MEMBER
RUNNING = member

[LOCALPOST]
FILE = templates/common/common.localpost
PLATFORM = moore
DEPENDENCIES = TRANSFER LOCALPOST-1
RUNNING = member
WALLCLOCK = 05:00


