[LOCAL_SETUP]
FILE = templates/common/common.localsetup
PLATFORM = LOCAL

[SYNCHRONIZE]
FILE = templates/common/common.synchronize.sh
PLATFORM = transfer_node
DEPENDENCIES = LOCAL_SETUP

[REMOTE_SETUP]
FILE = sources/runtime/autosubmit/compilation.sh
DEPENDENCIES = SYNCHRONIZE
WALLCLOCK = 4:00
PROCESSORS = 4

[INI]
FILE = templates/ecearth3/ecearth3.ini
DEPENDENCIES = REMOTE_SETUP
RUNNING = member
WALLCLOCK = 00:30
QUEUE = debug

[SIM]
FILE = sources/runtime/autosubmit/ece-esm.sh
DEPENDENCIES = INI SIM-1
RUNNING = chunk
WALLCLOCK = 10:00
PROCESSORS = 432
TASKS = 16
THREADS = 1
CHECK = False

[POST]
FILE = templates/ecearth3/ecearth3.post
DEPENDENCIES = SIM SIM+1
RUNNING = chunk
WALLCLOCK = 01:00

# when using the classic outclass make sure you are running POST in exclusive mode
# MN4
CUSTOM_DIRECTIVES = ["#SBATCH --exclusive" ]
PLATFORM = marenostrum4

# Nord3
#CUSTOM_DIRECTIVES = ["BSUB -R \"span[ptile=4]\"", "#BSUB -x"]


[CLEAN]
FILE = templates/ecearth3/ecearth3.clean
DEPENDENCIES = POST
RUNNING = chunk
WALLCLOCK = 00:30

[SAVEIC]
FILE = templates/common/common.saveic
DEPENDENCIES = SIM
RUNNING = chunk
WALLCLOCK = 02:00


[CLEAN_MEMBER]
FILE = templates/common/common.clean_member
DEPENDENCIES = CLEAN SAVEIC
RUNNING = member
WALLCLOCK = 02:00


[TRANSFER]
FILE = templates/common/common.localtrans
PLATFORM = transfer_node
DEPENDENCIES = CLEAN
RUNNING = chunk
QUEUE = debug

[PERFORMANCE_METRICS]
FILE = templates/ecearth3/ecearth3.performance_metrics.sh
DEPENDENCIES = TRANSFER
RUNNING = once
WALLCLOCK = 00:10
PROCESSORS = 1
PLATFORM = LOCAL

[TRANSFER_MEMBER]
FILE = templates/common/common.transfer_member
PLATFORM = transfer_node
DEPENDENCIES = CLEAN_MEMBER
RUNNING = member

#[LOCALPOST]
#FILE = templates/common/common.localpost
#PLATFORM = moore
#DEPENDENCIES = TRANSFER LOCALPOST-1
#RUNNING = member
#WALLCLOCK = 05:00

