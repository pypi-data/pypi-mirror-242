[monarch]
#-----------------------------------------------------------------------
# NEW: NESTING CONFIGURATION
# PREPROC configuration
#-----------------------------------------------------------------------
# Version of the preproc (0=FIX-VAR, 1=NPS) to be used. If NPS selected, remember to change the PREPROC_FIX job to run for each member!
VERSION_PREPROC = 0
# Number of domains (=1 no nesting; >1 nesting domains)
NUM_DOMAINS             = 1

#-----------------------------------------------------------------------
# Compute tasks definition (also change in jobs.conf)!
#-----------------------------------------------------------------------
# Number inpes (compute tasks in the I direction)
INPES 			= 32
# Number jnpes (compute tasks in the J direction)
JNPES 			= 48
# Number write tasks
WRTSK 			= 8
# Make sure to change PROCESSORS (must be equal to INPES*JNPES+WRTSK) under [SIM] section in jobs_$EXPID.conf

#-----------------------------------------------------------------------
# Model domain setup
#-----------------------------------------------------------------------
# Type of simulation
MODE = DUST_DA
# Name of the case (MEMBER will hang from CASE in paths) (global/regional)
CASE 			= regional
# Run time step (integer seconds)
DT_INT 			= 20
# Center point longitudinal (E/W)
TLM0D			= 20.0
# Center point latitudinal (S/N)
TPH0D			= 35.0
# Western boundary (from center point)
WBD				= -51.0
# Southern boundary (from center point)
SBD 			= -35.0
# Longitudinal grid resolution
DLMD 			= 0.1
# Latitudinal grid resolution
DPHD			= 0.1
# Vertical model layers
LM 				= 40
# Pressure top of the domain (Pa)
PTOP			= 5000.
# Mineral Dust Emission Calibration Factor
DCAL 			= 0.255 0.255 0.255 0.255 0.255 0.255 0.255 0.255 0.255 0.255 0.255 0.255
# Number of timesteps between radiation calls (short)
NRADS 			= 180
# Number of timesteps between radiation calls (long)
NRADL 			= 180

#-----------------------------------------------------------------------
# Ensemble perturbation factors
#-----------------------------------------------------------------------
DCALBIN1 = 1.106343 1.000612 1.082477 1.475536 0.843028 1.423721 1.309229 0.811747 0.995270 1.524607 0.823556 0.475334
DCALBIN2 = 1.098947 0.998531 1.074797 1.472015 0.850205 1.430319 1.299753 0.828486 1.002254 1.524329 0.830391 0.479323
DCALBIN3 = 1.097245 0.987129 1.093450 1.487424 0.828624 1.437714 1.325002 0.839012 1.009480 1.547502 0.882344 0.468367
DCALBIN4 = 1.165611 0.948493 1.082074 1.426227 0.866220 1.381353 1.371184 0.793838 1.048545 1.510950 0.816682 0.387790
DCALBIN5 = 1.116009 0.935082 1.101794 1.365402 0.785977 1.493562 1.390100 0.629129 1.101997 1.638613 0.739484 0.426551
DCALBIN6 = 1.080891 0.776795 1.287324 1.364965 0.912424 1.331407 1.327775 0.962559 0.923016 1.219089 0.897321 0.764757
DCALBIN7 = 1.126951 0.882573 1.407303 0.662187 0.865147 0.802836 1.357229 1.397023 0.811385 0.815051 1.133981 1.124143
DCALBIN8 = 0.548321 1.006390 0.886486 1.102514 1.394948 1.286722 1.174099 1.009974 0.945916 0.930637 1.395042 1.018455
PERTURB_USTH = 0.79705726 1.01643812 0.38722173 1.0121849 0.93356167 0.73258736 1.72922959 1.00050638 0.89468336 1.39104921 1.20099803 1.07560301

#-----------------------------------------------------------------------
#TUNING FOR SOIL HUMIDITY THRESHOLD AND WET DEPOSITION
#-----------------------------------------------------------------------
FECAN=1.75             # Fecan coefficient
BCL_MP_C=50.            # tuning factor for coarse dust below cloud scavenging (grid scale clouds)
BCL_MP_M=100.            # tuning factor for medium dust below cloud scavenging (grid scale clouds)
BCL_MP_F=100.            # tuning factor for fine dust below cloud scavenging (grid scale clouds)
BCL_BMJ_C=50.           # tuning factor for coarse dust below cloud scavenging (convective clouds)
BCL_BMJ_M=100.           # tuning factor for medium dust below cloud scavenging (convective clouds)
BCL_BMJ_F=100.           # tuning factor for fine dust below cloud scavenging (convective clouds)
ICL_MP=1.              # tuning factor for dust incloud scavenging (grid scale clouds)
ICL_BMJ=4.             # tuning factor for dust incloud scavenging (convective clouds)

SEDIM_TYPE=1            # sedimentation scheme (0-implicit,1 explicit) both upwind (pretty diffusive)
VSED5=0.5               # correction factor of sedimentation velocity for bin 5 to correct for diffusive scheme
VSED6=0.3               # correction factor of sedimentation velocity for bin 6 to correct for diffusive scheme
VSED7=0.2               # correction factor of sedimentation velocity for bin 7 to correct for diffusive scheme
VSED8=0.1               # correction factor of sedimentation velocity for bin 8 to correct for diffusive scheme

VDRY=0.5                # tuning factor for dry deposition velocity (excluding gravitational settling

#-----------------------------------------------------------------------
#CHOICE OF DUST SOURCE, EMITTED SIZE DISTRIBUTION AND EMISSION SCHEME
#-----------------------------------------------------------------------
SRC=3                  # 0 Old topographic source from Ginoux et al. (2001) derived at 0.25 degrees (DUSCHEME=0,1,2,3)
                       # 1 MODIS DB C6 based foo (climatology) derived at 0.1 degrees (both natural and anthropogenic together, HYDE 2) (DUSCHEME=0,1,2,3)
                       # 2 MODIS DB C6 based foo (climatology) derived at 0.1 degrees (tagged natural and anthropogenic, HYDE 2) (DUSCHEME=0,1,2,3)
                       # 3 Like #1 to identify the location of sources but like #0 (topo) for the calculation of the vertical flux (DUSCHEME=0,1,2)
                       # 4 Like #2 to identify the location of sources but like #0 (topo) for the calculation of the vertical flux (DUSCHEME=0,1,2)
#                        (#3 and #4 are equivalent to #1 and #2 respectively in the case of DUSCHEME=3)
#                        (For the options above, in the case of DUSCHEME>=3 (Kok, Shao, Klose), SRC is only used to identify the location of the sources) 
                       # 5 No source based on topo or MODIS (only DMASK) and no tagging
                       # 6 No source based on topo or MODIS (only DMASK) and tagging for anthropogenic and natural based on MODIS DB 
#                      [[[ the following options [7-14] use #0 (topo) for vertical flux in the case of DUSCHEME=0,1,2; no effect for DUSCHEME > 2 ]]]
                       # 7  MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (natural and anthropogenic together), actual year
                       # 8  MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland and pasture]), actual year
                       # 9  MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland, pasture, and converted rangeland]), actual year
                       # 10 MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland, pasture, conv. rangeland, and rangeland]), actual year
                       # 11 MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (natural and anthropogenic together), climatology
                       # 12 MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland and pasture]), climatology
                       # 13 MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland, pasture, and converted rangeland]), climatology
                       # 14 MODIS DB foo and HYDE 3.2.1 land use at 0.1 degrees (tagged natural and anthropogenic [cropland, pasture, conv. rangeland, and rangeland]), climatology

DMASK=1                # 0 Standard desert mask based on monthly vegetation fraction (Perez et al. 2011)
#                          (If SRC=0 it uses the fixed and already masked topo source)
                       # 1 Based on MODIS C5 monthly LAI for the specific year (available for 2001 to 2015)
                       # 2 Based on MODIS C5 monthly LAI climatology (2001 to 2015)
                       # 3 Based on Landsat and MODIS reflectance (Guerschman et al. 2015) (monthly data, 01/2001 to 08/2018)
                       # 4 Based on Landsat and MODIS reflectance (Guerschman et al. 2015) (monthly climatology, 2001-2017)

VEGF_UNI=1             # 0 Use default USGS climatological vegetation for meteorology and land-surface while using vegetation from DMASK/DRAG_PART for dust 
                       # 1 Use same vegetation (Guerschman et al. 2015) for meteorology and land-surface as for dust (only applies if DMASK = 3 or 4 and DRAG_PART = 4)

INTERP=0               

# 0 Bilinear interpolation of the New MODIS DB C6 foo sources and LAI to the model grid (recommended for resolutions < 0.1 deg)
# 1 Averaging the 0.1 deg new MODIS DB C6 foo sources and LAI over coarser resolution grid (recommended for resolutions > 0.1deg)

INTERP2=1              

# Always 1 for pringent roughness

SZDSTR=1               # 0 Emitted size distribution from D'Almeida
                       # 1 Emitted size distribution from Kok

# 0 NMMB default dust emission scheme (Perez et al 2011)
# 1 GOCART dust emission scheme from Paul Ginoux
# 2 GOCART dust emission scheme from Paul Ginoux with Fecan's humidity treatment as in Kok et al. 2014
# 3 KOK dust emission scheme (Kok et al. 2014)
# Ensemble perturbations have been implemented only for DUSCHEME=0,1,2
# Dust emission scheme for each ensemble member (they can differ per member): 
DUSCHEME=1 1 1 1 1 1 1 1 1 1 1 1

VSLAYER=0              # 0 NMMB default with viscous sublayer
                       # 1 no viscous sublayer (only applies for NMMB default dust scheme)

DRAG_PART=3            # 0 no drag partition scheme in the emission
                       # 1 drag partition forllowing Marticorena with X parameter = 10.
                       # 2 drag partition forllowing Marticorena with X parameter = 12255.
                       # 3 drag partition forllowing Marticorena with X parameter = 40.

MOIST_COR_01=0         # use moisture correction for cohesive force distribution, yes(1)/no(0); only for DUSCHEME=7

VEG_COR_01=0           # use vegetation correction for momentum flux distribution, yes(1)/no(0); only for DUSCHEME=7

#-----------------------------------------------------------------------
#CALCULATE NUMBER OF BINS BASED ON SOURCE CHOICE
#-----------------------------------------------------------------------
NDUST=8                   # 0 (No dust) or 8
CATAERO=2                 # 2 output dod (all sky and clear sky) (only 2 works)
NCHEM=

#-----------------------------------------------------------------------
#SELECT FLAGS FOR ARI: vobiso2018
#-----------------------------------------------------------------------
XMDL=0                 # flag for ARI module (mdlari in configfile)
                       #   : 0 -> OPAC climatology
                       #   : 3 -> MONARCH dynamic coupling
XMLC=0                 # flag for multiple call (mlcari in configfile)
                       #   : 0 -> no DRE
                       #   : 1 -> DRE of all types
                       #   : 2 -> DRE of single types (alone) + all types
                       #   : 3 -> DRE of single types (missing) + all types
XTBL=1                 # flag for optical table (tblari in configfile)
                       #   : 1 -> OPAC refractive indices (homogeneous dust components)
                       #   : 2 -> OPAC refractive indices + emission p50 for dust imaginary index in (0.25-2.00)µm
                       #   : 3 -> mineral refractive indices: external mixing
                       #   : 4 -> mineral refractive indices: internal mixing for hematite-clays (Maxwell-Garnett mixing rule)
XKOK=0                 # flag for shape (only for XTBL=1 or XTBL=2)
                       #   : 0 -> spheres
                       #   : 1 -> tri-axial spheroids for dust in (0.25-2.00)µm

#-----------------------------------------------------------------------
# Time Configuration
#-----------------------------------------------------------------------
# ** Start date is located in expdef_EXPID.conf **
# Choose the time of initial input data & start hour of the forecast (hours at leats two digits: 00 or 03 or 12 or ...)
HOUR			= 00
# Hours of spinup chemistry/aerosols
SPINUP                  = 0
# Length of the forecast (hours)
NHOURS			= 24
# History init previous day timestep (for couple dust, next run)
NHOURS_INIT		= 24
# Frequency of history output (up to 552 hours)
HIST 			= 6
# Frequency of boundary condition update for REGIONAL (hours)
BOCO			= 6
# Initial condition analysis files (GFS/FNL/ERA) for each ensemble member (they can differ per member):
TYPE_GFSINIT	= FNL FNL FNL FNL FNL FNL FNL FNL FNL FNL FNL FNL
# GFS/FNL degree resolution (0p25, 0p50, 1p00) - Global longitude-latitude grid files (analysis, initial condition files)
GFS_DEGREE_RES 	= 0p50
# Is this a forecast run? (true/false)
FCST = false
# Boundary condition chemistry (CAMS/MOZART)
TYPE_BCCHEM     =

#-----------------------------------------------------------------------
# Config file for compilation (use the one that is suitable for the host)
#-----------------------------------------------------------------------
# Select profile among the supported platforms in nceplibs compile script
NCEPLIBS_CONFIG = 5
# Compile the PartMC chemistry module? (0=no/1=yes)
# (To solve chemistry with PartMC, do_partmc in the job template must be set to true)
DO_PARTMC = 0
# NPS compilation - Select architecture (17=nord3, 18=mn4)
NPS_CONFIG = 18

#-----------------------------------------------------------------------
# Couple dust
#-----------------------------------------------------------------------
# Couple dust for the next chunk (0/1)
COUPLE_DUST 	= 1
# Couple dust from the beginning (0/1)
COUPLE_DUST_INIT= 0

# First chunk initialisation path with previous spinup history file
# please make sure that in an ensemble config the subdirectories names in this path must match the MEMBERS list (in expedf.conf)
SPINUP_FOLDER = /gpfs/archive/bsc32/esarchive/exp/monarch/EXPID/original_files/

# Select IC of chemistry for run with COUPLE_DUST_INIT=0
INIT_CHEM = 0                 # 0. IC from ideal conditions
                              # 1 initialize from a previous run
                              # 2 initialize from inca chem data
                              # 3 initialize from global nmmb-ctm run for regional
                              # 4 initialize from a previous run of different resolution

# How often (number of days) the history_INIT files are kept in /esarchive
SPINUP_SAVE_FREQ = 30

#-----------------------------------------------------------------------
# DUST_DA CONFIGURATION
#-----------------------------------------------------------------------
# Domain decomposition. Remember that (NPROC_LON * NPROC_LAT) must be the same number of procs required in jobs.conf!
NPROC_LON = 16
NPROC_LAT = 16

# radius of influence of the observations
NPATCH = 4

# number of time slots
DA_NSLOTS		= 4
# step between model output (hours) (Usually the same as Frequency of history output)
DA_IOSTEP		= 6
# time loop
MIN_SLOT = -3
MAX_SLOT = 0

# horizontal localization
LOCSIG_HOR = 2.0
# vertical localization
LOCSIG_VER = 1.0
# temporal localization
LOCSIG_TEMP = 3.0
# vertical extent (<=nlevg)
MAXILEVE = 38

INFLATION = 0.0
QC = 1.4

#######        function not available now!     #############
####### (requires post proc of observations files) #########
DA_FOLDER_ARCHIVE =
############################################################
DA_FOLDER_HPC     = /gpfs/projects/bsc32/bsc32137/LETKFSP/PREOBS/obs_2012_DB_PG01rotBC-2gt02_fullyear/

#-----------------------------------------------------------------------
# GLOBAL AEROSOL CONFIGURATION
#-----------------------------------------------------------------------
# Folders on HPC! (TODO: will be moved to esarchive?)
DATAMEGAN=/gpfs/projects/bsc32/models/monarch/data/static/emissions/DATA_megan_v2.04
# if not present, the first run of hermes will prepare static data
HERMES_AUXFILES=/gpfs/projects/bsc32/models/hermesv3
# static anthropogenic databases for HERMES
HERMES_DATA_ANTHRO=/gpfs/projects/bsc32/models/hermesv3/data
# HERMES temporal resolution of anthropogenic emissions ('hourly','daily','monthly','yearly'/ only works hourly)
HERMES_ANTHRO_RES='hourly'
# ** _HPC for files already on the remote machine **
# ** _REMOTE for files that has to be moved on HPC remote machine **
# GFAS files root folder
GFAS_FOLDER_ARCHIVE =/gpfs/archive/bsc32/esarchive/recon/ecmwf/gfas/daily_mean/multivar/
GFAS_FOLDER_HPC     =
# anthropogenic global emission data
AGE_FOLDER_ARCHIVE  =
AGE_FOLDER_HPC      =
# anthropogenic regional emission data
ARE_FOLDER_ARCHIVE  =
ARE_FOLDER_HPC      =

# Folders on HPC! (TODO: will be moved to esarchive?)
CHEMIC          =

#-----------------------------------------------------------------------
# ONLY_PREVAR_DUST mode: Output folder for monarch preprocess output files
#-----------------------------------------------------------------------
# Root folder from where to construct archiving path
#PREVAR_FOLDER_ARCHIVE = ${SPINUP_FOLDER}/original_files/prevar/
PREVAR_FOLDER_HPC = 

#-----------------------------------------------------------------------
# Initial condition analysis folder (without trailing slash! (/))
#-----------------------------------------------------------------------
# ** _HPC for files already on the remote machine **
# ** _REMOTE for files that has to be moved on HPC remote machine **
# GFS files root folder
GFS_FOLDER_ARCHIVE = /gpfs/archive/bsc32/esarchive/recon/ncep/gfs/original_files
GFS_FOLDER_HPC     =
# FNL files root folder
FNL_FOLDER_ARCHIVE = /gpfs/archive/bsc32/esarchive/recon/ncep/ds083.2/original_files
FNL_FOLDER_HPC     =
# ERA-Interim files root folder
ERA_FOLDER_ARCHIVE =
ERA_FOLDER_HPC     = /gpfs/projects/bsc32/models/monarch/data/initial/era-interim

#-----------------------------------------------------------------------
# Output folder for archive (without trailing slash! (/))
#-----------------------------------------------------------------------
# Root folder from where to construct archiving path
ARCHIVE_ROOT_FOLDER		= /gpfs/archive/bsc32/esarchive/exp

#-----------------------------------------------------------------------
# DT machines usage
#-----------------------------------------------------------------------
# Enable/disable use of DT machines for file transfers (TRUE/FALSE)
USE_DT_COMMANDS	= TRUE

#-----------------------------------------------------------------------
# STATIC data folders (without trailing slash! (/))
#-----------------------------------------------------------------------
# Absolute path at HPC that contains the shared Static data folder (created by hand)
#Leave it blank if you want to copy all Static data from repo to your experiment
STATIC_HPC_FOLDER	= /gpfs/projects/bsc32/models/monarch/data/static
# Local NAS repository folder (e.g.: /esnas/exp/nmmb-bsc-ctm_v2.0.4/constant)
CONSTANT_REPO_FOLDER	= /gpfs/archive/bsc32/esarchive/exp/monarch/static

#-----------------------------------------------------------------------
# REDUCE CONFIGURATION
#-----------------------------------------------------------------------
# Reduce output directory
REDUCE_OUTPUT_DIRECTORY = /esarchive/exp
# Configuration file for REDUCE
# (it must be present in the REDUCE repository or added in the local copy of the repository cloned in sources)
REDUCE_CSV_FILE = monarch_reduce_DUST_DA.csv
# remove the original files once the reduce has succesfully run (0/1)
REMOVE_ORIGINAL_FILES = 1
