[LOCAL_SETUP]
FILE = templates/local_setup.py
TYPE = python
PLATFORM = LOCAL
RUNNING = once
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_INITIAL]
FILE = templates/00_local_send_initial.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
#because different dates (chunk = day):
RUNNING = chunk
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_SPINUP]
FILE = templates/00d_local_send_spinup.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = member
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_SOURCE]
FILE = templates/01_local_send_source.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once

[LOCAL_SEND_STATIC]
FILE = templates/01b_local_send_static.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once

[LOCAL_SEND_OBS]
FILE = templates/local_send_obs.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
# If already preprocessed observations are used or OBS_FILE_TYPE is set to an, set RUNNING = chunk and SYNCHRONIZE = member
# If OBS_FILE_TYPE = re, set RUNNING to date and optionally use SPLITs (autosubmit 3.14 needed)
RUNNING = chunk
SYNCHRONIZE = member
#SPLITS = 6
DELAY = 0
NOTIFY_ON = FAILED COMPLETED

[REMOTE_COMPILE]
FILE = templates/02_compile.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
PROCESSORS = 4
WALLCLOCK = 00:50
CUSTOM_DIRECTIVES = ["#SBATCH -p interactive"]

[PREPROCFIX]
FILE = templates/03_preproc_fix.sh
DEPENDENCIES = REMOTE_COMPILE LOCAL_SEND_STATIC
# If using NPS, RUNNING must be set to member. Otherwise it should be set to once.
RUNNING = member
PROCESSORS = 8
WALLCLOCK = 00:30

[PREPROCVAR]
FILE = templates/04_preproc_var.sh
DEPENDENCIES = LOCAL_SEND_INITIAL PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = chunk
PROCESSORS = 8
WALLCLOCK = 00:30
NOTIFY_ON = FAILED COMPLETED

#** Remember to define a proper wallclock matching the configuration (resolution) of the model **
#** Remember that PROCESSORS must be equal to INPES*JNPES+WRTSK **
[SIM]
FILE = templates/05b_sim.sh
DEPENDENCIES = LOCAL_SEND_SPINUP PREPROCVAR SIM-1 DA-1
RUNNING = chunk
PROCESSORS = 1544
WALLCLOCK = 00:10
NOTIFY_ON = FAILED COMPLETED

[COMPILE_DA]
FILE = templates/02b_compile_da.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
WALLCLOCK = 00:20
NOTIFY_ON = FAILED COMPLETED

#[OBS_PREPROC]
#FILE = templates/obs_preproc.sh
#DEPENDENCIES = LOCAL_SEND_SOURCE LOCAL_SEND_OBS
#RUNNING = chunk
#SYNCHRONIZE = member
#WALLCLOCK = 00:30
#DELAY = 0

[DA]
FILE = templates/05c_da.sh
DEPENDENCIES = SIM LOCAL_SEND_OBS COMPILE_DA
RUNNING = chunk
SYNCHRONIZE = member
DELAY = 0
WALLCLOCK = 00:20
PROCESSORS = 256
NOTIFY_ON = FAILED COMPLETED

[POSTPROC]
FILE = templates/postprocess.sh
DEPENDENCIES = SIM DA POSTPROC-1
RUNNING = chunk
PROCESSORS = 48
WALLCLOCK = 00:30
NOTIFY_ON = FAILED COMPLETED

[POSTPROC_AN]
FILE = templates/postprocess.sh
DEPENDENCIES = SIM DA POSTPROC_AN-1
RUNNING = chunk
PROCESSORS = 48
WALLCLOCK = 00:30
NOTIFY_ON = FAILED COMPLETED

#[CALC_STATS]
#FILE = templates/calc_stats.py
#DEPENDENCIES = POSTPROC POSTPROC_AN
#RUNNING = chunk
#SYNCHRONIZE = member
#WALLCLOCK = 01:00
#TYPE = python
#EXECUTABLE = %HPCROOTDIR%/remoteconfig/%CURRENT_ARCH%_python_launcher.sh %TASKTYPE%
#NOTIFY_ON = FAILED COMPLETED

[ARCHIVE]
FILE = templates/06_archive.sh
DEPENDENCIES = POSTPROC POSTPROC_AN ARCHIVE-1
#DEPENDENCIES = CALC_STATS ARCHIVE-1
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 01:00
NOTIFY_ON = FAILED COMPLETED

[CLEAN]
FILE = templates/08_clean.sh
DEPENDENCIES = POSTPROC+1 POSTPROC_AN+1 ARCHIVE
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 00:10
NOTIFY_ON = FAILED COMPLETED
