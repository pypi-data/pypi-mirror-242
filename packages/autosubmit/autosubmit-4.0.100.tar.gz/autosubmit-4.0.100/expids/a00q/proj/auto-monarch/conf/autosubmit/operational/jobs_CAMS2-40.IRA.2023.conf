[LOCAL_SETUP]
FILE = templates/local_setup.py
TYPE = python
PLATFORM = LOCAL
RUNNING = once
NOTIFY_ON = FAILED
WALLCLOCK = 02:00

[FIRST_CLEAN]
FILE = templates/operational/first_clean.sh
PLATFORM = marenostrum_archive
RUNNING = once
WALLCLOCK = 00:05
NOTIFY_ON = FAILED

[LOCAL_SEND_INITIAL]
FILE = templates/00_local_send_initial.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP FIRST_CLEAN
#because different dates (chunk = day):
RUNNING = chunk
NOTIFY_ON = FAILED
WALLCLOCK = 02:00

[LOCAL_SEND_SPINUP]
FILE = templates/00d_local_send_spinup.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP FIRST_CLEAN
RUNNING = member
NOTIFY_ON = FAILED
WALLCLOCK = 02:00

[LOCAL_SEND_SOURCE]
FILE = templates/01_local_send_source.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once
WALLCLOCK = 02:00

[LOCAL_SEND_STATIC]
FILE = templates/01b_local_send_static.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once
NOTIFY = FAILED
WALLCLOCK = 02:00

[LOCAL_SEND_HERMES]
FILE = templates/hermes/local_send_hermes.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
PLATFORM = marenostrum_archive
RUNNING = once
NOTIFY = FAILED
WALLCLOCK = 02:00

[LOCAL_SEND_EMISSIONS]
FILE = templates/hermes/local_send_emissions.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP FIRST_CLEAN
#because different dates (chunk = day):
RUNNING = chunk
SYNCHRONIZE = member
NOTIFY_ON = FAILED
WALLCLOCK = 02:00

[LOCAL_SEND_OBS]
FILE = templates/local_send_obs.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP FIRST_CLEAN LOCAL_SEND_OBS-1
RUNNING = chunk
SYNCHRONIZE = member
NOTIFY_ON = FAILED
RETRIALS = 9
DELAY_RETRY_TIME = 600
WALLCLOCK = 02:00

[REMOTE_COMPILE]
FILE = templates/02_compile.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
PROCESSORS = 4
WALLCLOCK = 00:50
#CUSTOM_DIRECTIVES = ["#SBATCH -p interactive"]
NOTIFY_ON = FAILED

[PREPROCFIX]
FILE = templates/03_preproc_fix.sh
DEPENDENCIES = REMOTE_COMPILE LOCAL_SEND_STATIC
#If fix-var = once, nps = member
RUNNING = once
WALLCLOCK = 00:30
NOTIFY_ON = FAILED

[LOCAL_SEND_CHEM]
FILE = templates/local_send_chem.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP FIRST_CLEAN
#because different dates (chunk = day):
RUNNING = chunk
SYNCHRONIZE = member
NOTIFY_ON = FAILED
WALLCLOCK = 02:00

[CHECK_CAMS]
FILE = templates/operational/cams2_40/check_cams.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SEND_CHEM?
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 00:30
NOTIFY_ON = FAILED

[PREPROCVAR]
FILE = templates/04_preproc_var.sh
DEPENDENCIES = LOCAL_SEND_INITIAL CHECK_CAMS PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = chunk
WALLCLOCK = 00:30
NOTIFY_ON = FAILED
CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]

#** The number of processors selected must be the same as the HERMESv3_GR job
[HERMESv3_GR_PREPROC]
FILE = templates/hermes/hermesv3_gr_preproc.sh
DEPENDENCIES = LOCAL_SEND_HERMES PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = date
WALLCLOCK = 00:20
NOTIFY_ON = FAILED
PROCESSORS = 100
RETRIALS = 2

[HERMESv3_GR]
FILE = templates/hermes/hermesv3_gr.sh
DEPENDENCIES = HERMESv3_GR_PREPROC LOCAL_SEND_EMISSIONS
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 01:00
PROCESSORS = 100
#DELAY = 1
RETRIALS = 2
#CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]
NOTIFY_ON = FAILED

[PERTURB_HERMES]
FILE = templates/hermes/perturb_hermes.sh
DEPENDENCIES = HERMESv3_GR
#PLATFORM = nord3
RUNNING = chunk
WALLCLOCK = 00:20
PROCESSORS = 48
NOTIFY_ON = FAILED
#DELAY = 1
CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]

#** Remember to define a proper wallclock matching the configuration (resolution) of the model **
#** Remember that PROCESSORS must be equal to INPES*JNPES+WRTSK **
[SIM]
FILE = templates/05b_sim.sh
DEPENDENCIES = LOCAL_SEND_SPINUP PREPROCVAR SIM-1 PERTURB_HERMES
RUNNING = chunk
PROCESSORS = 96
WALLCLOCK = 01:30
NOTIFY_ON = FAILED

[COMPILE_DA]
FILE = templates/02b_compile_da.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
WALLCLOCK = 00:10
NOTIFY_ON = FAILED

[COMPILE_OBSPREPROC]
FILE = templates/compile_obspreproc.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
WALLCLOCK = 00:10
NOTIFY_ON = FAILED

[OBS_PREPROC]
FILE = templates/obs_preproc.sh
#PLATFORM = nord3v2
DEPENDENCIES = LOCAL_SEND_SOURCE LOCAL_SEND_OBS? COMPILE_OBSPREPROC
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 00:30
DELAY = 0
NOTIFY_ON = FAILED
#CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]

[CHECK_OBS]
FILE = templates/operational/cams2_40/check_obs.sh
DEPENDENCIES = OBS_PREPROC?
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 00:30
DELAY = 0
SPLITS = 6

[DA]
FILE = templates/05c_da.sh
DEPENDENCIES = SIM CHECK_OBS COMPILE_DA
SELECT_MEMBERS = SIM*[0:5]
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 00:40
PROCESSORS = 96
NOTIFY_ON = FAILED
SPLITS = 6

[OBS_REPORT]
FILE = templates/operational/cams2_40/obs_report.sh
DEPENDENCIES = DA
PLATFORM = LOCAL
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 00:30
DELAY = 0
NOTIFY_ON = FAILED

[POSTPROC_CTRL]
FILE = templates/postprocess.sh
DEPENDENCIES = SIM
RUNNING = chunk
SELECT_MEMBERS = SIM*[6]
EXCLUDED_MEMBERS = [0:5]
PROCESSORS = 48
WALLCLOCK = 01:00
NOTIFY_ON = FAILED

[POSTPROC_AN]
FILE = templates/postprocess.sh
DEPENDENCIES = DA
#PLATFORM = nord3
RUNNING = chunk
SYNCHRONIZE = member
PROCESSORS = 25
WALLCLOCK = 00:30
NOTIFY_ON = FAILED
SPLITS = 6

[UPLOAD_FTP]
FILE = templates/operational/cams2_40/upload_ftp.sh
DEPENDENCIES = POSTPROC_CTRL POSTPROC_AN
PLATFORM = marenostrum0
EXCLUDED_MEMBERS = [0:5]
RUNNING = chunk
NOTIFY_ON = FAILED COMPLETED
WALLCLOCK = 01:00:00

[ARCHIVE]
FILE = templates/06_archive.sh
DEPENDENCIES = POSTPROC_CTRL POSTPROC_AN
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 01:00
NOTIFY_ON = FAILED

[ARCHIVE_CAMS]
FILE = templates/operational/cams2_40/archive_cams.sh
DEPENDENCIES = POSTPROC_CTRL POSTPROC_AN
PLATFORM = marenostrum_archive
RUNNING = chunk
SYNCHRONIZE = member
WALLCLOCK = 01:30
NOTIFY_ON = FAILED

[UPLOAD_FTP_LOCAL]
FILE = templates/operational/cams2_40/upload_ftp.sh
DEPENDENCIES = ARCHIVE_CAMS UPLOAD_FTP?
EXCLUDED_MEMBERS = [0:5]
RUNNING = chunk
PLATFORM = LOCAL
NOTIFY_ON = FAILED COMPLETED

[CLEAN]
FILE = templates/08_clean.sh
DEPENDENCIES = ARCHIVE ARCHIVE_CAMS UPLOAD_FTP
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 00:10
NOTIFY_ON = FAILED
RETRIALS = 0

[CLEAN_ESARCHIVE]
FILE = templates/operational/clean_esarchive.py
DEPENDENCIES = ARCHIVE ARCHIVE_CAMS
TYPE = python
PLATFORM = LOCAL
RUNNING = chunk
WALLCLOCK = 00:10
NOTIFY_ON = FAILED
