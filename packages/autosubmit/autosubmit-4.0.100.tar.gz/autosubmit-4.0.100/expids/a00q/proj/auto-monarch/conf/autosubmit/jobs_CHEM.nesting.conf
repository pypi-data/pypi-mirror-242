[LOCAL_SETUP]
FILE = templates/local_setup.py
TYPE = python
PLATFORM = LOCAL
RUNNING = once
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_INITIAL]
FILE = templates/00_local_send_initial.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
#because different dates (chunk = day):
RUNNING = chunk
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_SPINUP]
FILE = templates/00d_local_send_spinup.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = member
NOTIFY_ON = FAILED COMPLETED

[LOCAL_SEND_SOURCE]
FILE = templates/01_local_send_source.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once

[LOCAL_SEND_STATIC]
FILE = templates/01b_local_send_static.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP
RUNNING = once

[LOCAL_SEND_HERMES]
FILE = templates/hermes/local_send_hermes.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
PLATFORM = marenostrum_archive
RUNNING = once
NOTIFY = FAILED

[LOCAL_SEND_EMISSIONS]
FILE = templates/hermes/local_send_emissions.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP LOCAL_SEND_EMISSIONS-1 SIM-1
#because different dates (chunk = day):
RUNNING = chunk
SYNCHRONIZE = member
DELAY = 1
NOTIFY_ON = FAILED

[LOCAL_SEND_CHEM]
FILE = templates/local_send_chem.sh
PLATFORM = marenostrum_archive
DEPENDENCIES = LOCAL_SETUP LOCAL_SEND_CHEM-1 SIM-1
#because different dates (chunk = day):
RUNNING = chunk
NOTIFY_ON = FAILED COMPLETED

[REMOTE_COMPILE]
FILE = templates/02_compile.sh
DEPENDENCIES = LOCAL_SEND_SOURCE
RUNNING = once
PROCESSORS = 4
WALLCLOCK = 00:50
CUSTOM_DIRECTIVES = ["#SBATCH -p interactive"]

[PREPROCFIX]
FILE = templates/03_preproc_fix.sh
DEPENDENCIES = REMOTE_COMPILE LOCAL_SEND_STATIC
#If fix-var = once, nps = member
RUNNING = member
WALLCLOCK = 00:30

[PREPROCVAR]
FILE = templates/04_preproc_var.sh
DEPENDENCIES = LOCAL_SEND_INITIAL LOCAL_SEND_CHEM PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = chunk
WALLCLOCK = 00:30
NOTIFY_ON = FAILED COMPLETED
CUSTOM_DIRECTIVES = ["#SBATCH --exclusive"]

#** The number of processors selected must be the same as the HERMESv3_GR job
#** Max PROCESSORS = NY/2 - NY is number of grid cells in the Y direction, MIN(NY n domains).
[HERMESv3_GR_PREPROC]
FILE = templates/hermes/hermesv3_gr_preproc.sh
DEPENDENCIES = LOCAL_SEND_HERMES PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = member
WALLCLOCK = 02:00
NOTIFY_ON = FAILED COMPLETED
PROCESSORS = 50
RETRIALS = 4

#** The number of processors selected must be > 12 (number of emission sectors)
[HERMESv3_BU_PREPROC]
FILE = templates/hermes/hermesv3_bu_preproc.sh
DEPENDENCIES = LOCAL_SEND_HERMES PREPROCFIX
#In Autosubmit nomenclature chunk will be our days (because days is used for start days)
RUNNING = member
WALLCLOCK = 02:00
NOTIFY_ON = FAILED COMPLETED
PROCESSORS = 720
RETRIALS = 4

#** The number of processors selected must be the same as the HERMESv3_GR_PREPROC job
#** Max PROCESSORS = NY/2 - NY is number of grid cells in the Y direction, MIN(NY n domains).
[HERMESv3_GR]
FILE = templates/hermes/hermesv3_gr.sh
DEPENDENCIES = HERMESv3_GR_PREPROC LOCAL_SEND_EMISSIONS
RUNNING = chunk
WALLCLOCK = 00:40
PROCESSORS = 50
DELAY = 1

#** There is no limit on the number of processors
[HERMESv3_BU]
FILE = templates/hermes/hermesv3_bu.sh
DEPENDENCIES = HERMESv3_BU_PREPROC
RUNNING = chunk
WALLCLOCK = 00:40
PROCESSORS = 336
DELAY = 1

[HERMESv3_sum]
FILE = templates/hermes/hermesv3_sum.sh
DEPENDENCIES = HERMESv3_BU HERMESv3_GR
RUNNING = chunk
WALLCLOCK = 00:40
PROCESSORS = 1
DELAY = 1

#** Remember to define a proper wallclock matching the configuration (resolution) of the model **
#** Remember that PROCESSORS must be equal to INPES*JNPES+WRTSK **
[SIM]
FILE = templates/05b_sim.sh
#DEPENDENCIES = LOCAL_SEND_SPINUP PREMEGAN-1 PREPROCVAR SIM-1 HERMESv3_sum
DEPENDENCIES = LOCAL_SEND_SPINUP PREPROCVAR SIM-1 HERMESv3_sum
RUNNING = chunk
PROCESSORS = 382
WALLCLOCK = 06:30
NOTIFY_ON = FAILED COMPLETED

#[PREMEGAN]
#FILE = templates/05d_premegan.sh
#DEPENDENCIES = SIM
#RUNNING = chunk
#WALLCLOCK = 01:00
#PROCESSORS = 1

[POSTPROC]
FILE = templates/postprocess.sh
#DEPENDENCIES = PREMEGAN+1 POSTPROC-1
DEPENDENCIES = SIM+1 POSTPROC-1
RUNNING = chunk
PROCESSORS = 48
WALLCLOCK = 00:30
NOTIFY_ON = FAILED COMPLETED

[ARCHIVE]
FILE = templates/06_archive.sh
DEPENDENCIES = POSTPROC ARCHIVE-1
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 00:10
NOTIFY_ON = FAILED COMPLETED

[CLEAN]
FILE = templates/08_clean.sh
DEPENDENCIES = POSTPROC+1 ARCHIVE
PLATFORM = marenostrum_archive
RUNNING = chunk
WALLCLOCK = 00:10
NOTIFY_ON = FAILED COMPLETED
