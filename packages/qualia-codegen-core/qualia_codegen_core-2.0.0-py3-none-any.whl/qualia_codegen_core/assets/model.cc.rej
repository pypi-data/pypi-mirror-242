--- assets/model.cc
+++ assets/model.cc
@@ -46,11 +46,9 @@ void cnn(
     {%- if innode.q.number_type != node.q.number_type or innode.q.width != node.q.width +%}
   // TYPE WARNING for {{node.layer.name}} Innode {{innode.layer.name}} 
   // innode is {{qtype2ctype(innode.q.number_type, innode.q.width)}} type and layer is {{qtype2ctype(node.q.number_type, node.q.width)}} type
-  {{ qtype2ctype(node.q.number_type, node.q.width) }} {{node.layer.name}}_input_convert
-      {%- for i in range(innode.output_shape|length) -%}
-        {%- if innode.output_shape[i] is not none -%}
-          [{{innode.output_shape[i]}}]
-        {%- endif -%}
+  {{ qtype2ctype(node.q.number_type, node.q.width) }} {{innode.layer.name}}_output_convert_{{outer_loop.index}}
+      {%- for dim in node.input_shape[loop.index - 1][1:] -%}
+          [{{dim}}]
       {%- endfor -%};
   {{ qtype2ctype(innode.q.number_type, innode.q.width) }}_to_{{ qtype2ctype(node.q.number_type, node.q.width) }}(
       {%- if outer_loop.index == 1 %} // First layer uses input passed as model parameter
@@ -58,16 +56,8 @@ void cnn(
       {%- else %}
         **activations{{ allocation.index[innode] }}.{{ innode.layer.name }}_output,
       {%- endif -%}
-        **{{node.layer.name}}_input_convert, 
-      {%- for i in range(innode.output_shape|length) -%}
-        {%- if innode.output_shape[i] is not none -%}
-          {{innode.output_shape[i]}}
-          {%- if i < innode.output_shape|length - 1 -%}
-          *
-          {%- endif -%}
-        {%- endif -%}
-      {%- endfor -%}
-        ,
+        **{{innode.layer.name}}_output_convert_{{outer_loop.index}},
+        {{ node.input_shape[loop.index - 1][1:] | join('*') }},
         {{innode.q.output_scale_factor}});
     {%- endif -%}
   {%- endfor %}
